2025-09-30T01:34:40.3093083Z ##[group]Run pytest tests/e2e/ -v --tb=short
2025-09-30T01:34:40.3093412Z [36;1mpytest tests/e2e/ -v --tb=short[0m
2025-09-30T01:34:40.3113433Z shell: /usr/bin/bash -e {0}
2025-09-30T01:34:40.3113669Z env:
2025-09-30T01:34:40.3114259Z   DATABASE_URL: ***localhost:5432/postgres
2025-09-30T01:34:40.3114491Z   CI: true
2025-09-30T01:34:40.3114684Z   SECRET_KEY: test-secret-key-for-ci
2025-09-30T01:34:40.3114924Z   ALGORITHM: HS256
2025-09-30T01:34:40.3115108Z   ACCESS_TOKEN_EXPIRE_MINUTES: 30
2025-09-30T01:34:40.3115334Z   APP_NAME: The Gathering Test
2025-09-30T01:34:40.3115542Z   DEBUG: false
2025-09-30T01:34:40.3115724Z   DEEPL_API_KEY: test-deepl-key-for-ci
2025-09-30T01:34:40.3116021Z   pythonLocation: /opt/hostedtoolcache/Python/3.13.7/x64
2025-09-30T01:34:40.3116397Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.13.7/x64/lib/pkgconfig
2025-09-30T01:34:40.3116750Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-09-30T01:34:40.3117066Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-09-30T01:34:40.3117419Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-09-30T01:34:40.3117738Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.13.7/x64/lib
2025-09-30T01:34:40.3117996Z ##[endgroup]
2025-09-30T01:34:41.3220838Z ============================= test session starts ==============================
2025-09-30T01:34:41.3224109Z platform linux -- Python 3.13.7, pytest-8.4.1, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-09-30T01:34:41.3227103Z cachedir: .pytest_cache
2025-09-30T01:34:41.3229921Z rootdir: /home/runner/work/the_gathering_beta/the_gathering_beta
2025-09-30T01:34:41.3232645Z configfile: pytest.ini
2025-09-30T01:34:41.3235413Z plugins: anyio-4.11.0, asyncio-0.25.1, cov-6.2.1
2025-09-30T01:34:41.3237904Z asyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=session
2025-09-30T01:34:41.3771101Z collecting ... collected 18 items
2025-09-30T01:34:41.3772302Z 
2025-09-30T01:34:43.1662710Z tests/e2e/test_critical_workflows.py::TestCriticalUserJourneys::test_complete_chat_workflow FAILED [  5%]
2025-09-30T01:34:44.7306089Z tests/e2e/test_critical_workflows.py::TestCriticalUserJourneys::test_room_closure_workflow FAILED [ 11%]
2025-09-30T01:34:45.1890785Z tests/e2e/test_critical_workflows.py::TestCriticalUserJourneys::test_authentication_security FAILED [ 16%]
2025-09-30T01:34:46.1852616Z tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_message_xor_constraint FAILED [ 22%]
2025-09-30T01:34:46.1854899Z tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_message_xor_constraint ERROR [ 22%]
2025-09-30T01:34:46.9251733Z tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_unique_constraints ERROR [ 27%]
2025-09-30T01:34:47.4435259Z tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_foreign_key_constraints FAILED [ 33%]
2025-09-30T01:34:48.4223341Z tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_conversation_participant_constraints FAILED [ 38%]
2025-09-30T01:34:48.4226093Z tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_conversation_participant_constraints ERROR [ 38%]
2025-09-30T01:34:49.1592102Z tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_enum_validation ERROR [ 44%]
2025-09-30T01:34:50.3493985Z tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_nullable_constraints FAILED [ 50%]
2025-09-30T01:34:50.3497029Z tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_nullable_constraints ERROR [ 50%]
2025-09-30T01:34:51.0733277Z tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_cascading_deletes ERROR [ 55%]
2025-09-30T01:34:51.4693971Z tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_database_indexes_exist FAILED [ 61%]
2025-09-30T01:34:51.5404418Z tests/e2e/test_integration_api.py::TestIntegrationAPI::test_health_check_endpoint PASSED [ 66%]
2025-09-30T01:34:52.0697514Z tests/e2e/test_integration_api.py::TestIntegrationAPI::test_room_count_endpoint FAILED [ 72%]
2025-09-30T01:34:52.5850349Z tests/e2e/test_integration_api.py::TestIntegrationAPI::test_get_all_rooms_endpoint FAILED [ 77%]
2025-09-30T01:34:53.0935313Z tests/e2e/test_integration_api.py::TestIntegrationAPI::test_get_room_by_id_endpoint FAILED [ 83%]
2025-09-30T01:34:53.6737186Z tests/e2e/test_integration_api.py::TestIntegrationAPI::test_join_room_workflow FAILED [ 88%]
2025-09-30T01:34:54.1962895Z tests/e2e/test_integration_api.py::TestIntegrationAPI::test_send_and_get_messages_workflow FAILED [ 94%]
2025-09-30T01:34:54.8052846Z tests/e2e/test_integration_api.py::TestIntegrationAPI::test_leave_room_workflow FAILED [100%]
2025-09-30T01:34:54.8053898Z 
2025-09-30T01:34:54.8054336Z ==================================== ERRORS ====================================
2025-09-30T01:34:54.8055334Z ___ ERROR at teardown of TestDatabaseConstraints.test_message_xor_constraint ___
2025-09-30T01:34:54.8056679Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:811: in ping
2025-09-30T01:34:54.8057805Z     _ = self.await_(self._async_ping())
2025-09-30T01:34:54.8058376Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8059677Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.8061474Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.8062446Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8063543Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.8064692Z     value = await result
2025-09-30T01:34:54.8068265Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.8076613Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:820: in _async_ping
2025-09-30T01:34:54.8077860Z     await tr.start()
2025-09-30T01:34:54.8078496Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/transaction.py:107: in start
2025-09-30T01:34:54.8092194Z     raise apg_errors.InterfaceError(
2025-09-30T01:34:54.8093095Z E   asyncpg.exceptions._base.InterfaceError: cannot use Connection.transaction() in a manually started transaction
2025-09-30T01:34:54.8093833Z 
2025-09-30T01:34:54.8094134Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.8095088Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:145: in __init__
2025-09-30T01:34:54.8096011Z     self._dbapi_connection = engine.raw_connection()
2025-09-30T01:34:54.8096498Z                              ^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8097421Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:3297: in raw_connection
2025-09-30T01:34:54.8098334Z     return self.pool.connect()
2025-09-30T01:34:54.8098716Z            ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8100324Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:449: in connect
2025-09-30T01:34:54.8101191Z     return _ConnectionFairy._checkout(self)
2025-09-30T01:34:54.8101640Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8102469Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:1363: in _checkout
2025-09-30T01:34:54.8103290Z     with util.safe_reraise():
2025-09-30T01:34:54.8103647Z          ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8104479Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
2025-09-30T01:34:54.8105406Z     raise exc_value.with_traceback(exc_tb)
2025-09-30T01:34:54.8106527Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:1301: in _checkout
2025-09-30T01:34:54.8107410Z     result = pool._dialect._do_ping_w_event(
2025-09-30T01:34:54.8108297Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:720: in _do_ping_w_event
2025-09-30T01:34:54.8109578Z     return self.do_ping(dbapi_connection)
2025-09-30T01:34:54.8110011Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8110963Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:1163: in do_ping
2025-09-30T01:34:54.8111956Z     dbapi_connection.ping()
2025-09-30T01:34:54.8112804Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:813: in ping
2025-09-30T01:34:54.8113724Z     self._handle_exception(error)
2025-09-30T01:34:54.8114735Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.8115787Z     raise translated_error from error
2025-09-30T01:34:54.8117243Z E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot use Connection.transaction() in a manually started transaction
2025-09-30T01:34:54.8118573Z 
2025-09-30T01:34:54.8118885Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.8119977Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytest_asyncio/plugin.py:347: in finalizer
2025-09-30T01:34:54.8120852Z     event_loop.run_until_complete(task)
2025-09-30T01:34:54.8121642Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:725: in run_until_complete
2025-09-30T01:34:54.8122421Z     return future.result()
2025-09-30T01:34:54.8122786Z            ^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8123605Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytest_asyncio/plugin.py:338: in async_finalizer
2025-09-30T01:34:54.8124554Z     await gen_obj.__anext__()  # type: ignore[union-attr]
2025-09-30T01:34:54.8125038Z     ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8125439Z tests/e2e/conftest.py:76: in async_db_session
2025-09-30T01:34:54.8125939Z     async with async_engine.begin() as conn:
2025-09-30T01:34:54.8126371Z                ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8127021Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/contextlib.py:214: in __aenter__
2025-09-30T01:34:54.8127733Z     return await anext(self.gen)
2025-09-30T01:34:54.8128117Z            ^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8128948Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/engine.py:1066: in begin
2025-09-30T01:34:54.8129872Z     async with conn:
2025-09-30T01:34:54.8130238Z                ^^^^
2025-09-30T01:34:54.8130998Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/base.py:121: in __aenter__
2025-09-30T01:34:54.8131954Z     return await self.start(is_ctxmanager=True)
2025-09-30T01:34:54.8132409Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8133423Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/engine.py:274: in start
2025-09-30T01:34:54.8134387Z     await greenlet_spawn(self.sync_engine.connect)
2025-09-30T01:34:54.8135418Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
2025-09-30T01:34:54.8136396Z     result = context.switch(value)
2025-09-30T01:34:54.8136795Z              ^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8141289Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:3273: in connect
2025-09-30T01:34:54.8142161Z     return self._connection_cls(self)
2025-09-30T01:34:54.8142568Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8146747Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:147: in __init__
2025-09-30T01:34:54.8147906Z     Connection._handle_dbapi_exception_noconnection(
2025-09-30T01:34:54.8149030Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2436: in _handle_dbapi_exception_noconnection
2025-09-30T01:34:54.8152754Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-09-30T01:34:54.8153752Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:145: in __init__
2025-09-30T01:34:54.8154659Z     self._dbapi_connection = engine.raw_connection()
2025-09-30T01:34:54.8155146Z                              ^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8156042Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:3297: in raw_connection
2025-09-30T01:34:54.8156953Z     return self.pool.connect()
2025-09-30T01:34:54.8157335Z            ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8160459Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:449: in connect
2025-09-30T01:34:54.8161349Z     return _ConnectionFairy._checkout(self)
2025-09-30T01:34:54.8161789Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8162625Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:1363: in _checkout
2025-09-30T01:34:54.8163466Z     with util.safe_reraise():
2025-09-30T01:34:54.8163840Z          ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8164669Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
2025-09-30T01:34:54.8167852Z     raise exc_value.with_traceback(exc_tb)
2025-09-30T01:34:54.8168703Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:1301: in _checkout
2025-09-30T01:34:54.8169693Z     result = pool._dialect._do_ping_w_event(
2025-09-30T01:34:54.8170634Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:720: in _do_ping_w_event
2025-09-30T01:34:54.8171605Z     return self.do_ping(dbapi_connection)
2025-09-30T01:34:54.8172035Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8175266Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:1163: in do_ping
2025-09-30T01:34:54.8176251Z     dbapi_connection.ping()
2025-09-30T01:34:54.8177148Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:813: in ping
2025-09-30T01:34:54.8178117Z     self._handle_exception(error)
2025-09-30T01:34:54.8179261Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.8182630Z     raise translated_error from error
2025-09-30T01:34:54.8184158Z E   sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot use Connection.transaction() in a manually started transaction
2025-09-30T01:34:54.8185802Z E   (Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-09-30T01:34:54.8186566Z ______ ERROR at setup of TestDatabaseConstraints.test_unique_constraints _______
2025-09-30T01:34:54.8190292Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:545: in _prepare_and_execute
2025-09-30T01:34:54.8191488Z     self._rows = deque(await prepared_stmt.fetch(*parameters))
2025-09-30T01:34:54.8192027Z                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8192827Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
2025-09-30T01:34:54.8193556Z     data = await self.__bind_execute(args, 0, timeout)
2025-09-30T01:34:54.8193963Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8194776Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
2025-09-30T01:34:54.8195876Z     data, status, _ = await self.__do_execute(
2025-09-30T01:34:54.8196796Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
2025-09-30T01:34:54.8197774Z     return await executor(protocol)
2025-09-30T01:34:54.8198197Z            ^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8198662Z asyncpg/protocol/protocol.pyx:206: in bind_execute
2025-09-30T01:34:54.8199274Z     ???
2025-09-30T01:34:54.8200029Z E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_username"
2025-09-30T01:34:54.8200912Z E   DETAIL:  Key (username)=(testuser) already exists.
2025-09-30T01:34:54.8204546Z 
2025-09-30T01:34:54.8204840Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.8206139Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1963: in _exec_single_context
2025-09-30T01:34:54.8207745Z     self.dialect.do_execute(
2025-09-30T01:34:54.8209335Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:943: in do_execute
2025-09-30T01:34:54.8210931Z     cursor.execute(statement, parameters)
2025-09-30T01:34:54.8212603Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
2025-09-30T01:34:54.8214297Z     self._adapt_connection.await_(
2025-09-30T01:34:54.8215871Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.8218039Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.8219427Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8221055Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.8222718Z     value = await result
2025-09-30T01:34:54.8223275Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.8224937Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
2025-09-30T01:34:54.8226810Z     self._handle_exception(error)
2025-09-30T01:34:54.8228536Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
2025-09-30T01:34:54.8230566Z     self._adapt_connection._handle_exception(error)
2025-09-30T01:34:54.8232422Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.8234239Z     raise translated_error from error
2025-09-30T01:34:54.8236726Z E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_username"
2025-09-30T01:34:54.8239527Z E   DETAIL:  Key (username)=(testuser) already exists.
2025-09-30T01:34:54.8240126Z 
2025-09-30T01:34:54.8240629Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.8242462Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytest_asyncio/plugin.py:375: in _async_fixture_wrapper
2025-09-30T01:34:54.8244145Z     result = event_loop.run_until_complete(setup_task)
2025-09-30T01:34:54.8244952Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8246311Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:725: in run_until_complete
2025-09-30T01:34:54.8247653Z     return future.result()
2025-09-30T01:34:54.8248215Z            ^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8249594Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytest_asyncio/plugin.py:370: in setup
2025-09-30T01:34:54.8251259Z     res = await func(**_add_kwargs(func, kwargs, event_loop, request))
2025-09-30T01:34:54.8252395Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8253175Z tests/e2e/conftest.py:160: in created_user
2025-09-30T01:34:54.8253920Z     await async_db_session.commit()
2025-09-30T01:34:54.8255531Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1014: in commit
2025-09-30T01:34:54.8257136Z     await greenlet_spawn(self.sync_session.commit)
2025-09-30T01:34:54.8258833Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
2025-09-30T01:34:54.8260619Z     result = context.switch(value)
2025-09-30T01:34:54.8261259Z              ^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8262632Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2032: in commit
2025-09-30T01:34:54.8264110Z     trans.commit(_to_root=True)
2025-09-30T01:34:54.8265521Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.8267010Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.8267645Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8269004Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1313: in commit
2025-09-30T01:34:54.8270557Z     self._prepare_impl()
2025-09-30T01:34:54.8271768Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.8273291Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.8273927Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8275396Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1288: in _prepare_impl
2025-09-30T01:34:54.8276926Z     self.session.flush()
2025-09-30T01:34:54.8278215Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4345: in flush
2025-09-30T01:34:54.8279669Z     self._flush(objects)
2025-09-30T01:34:54.8280240Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4480: in _flush
2025-09-30T01:34:54.8280924Z     with util.safe_reraise():
2025-09-30T01:34:54.8281229Z          ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8281917Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
2025-09-30T01:34:54.8282654Z     raise exc_value.with_traceback(exc_tb)
2025-09-30T01:34:54.8283322Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4441: in _flush
2025-09-30T01:34:54.8284004Z     flush_context.execute()
2025-09-30T01:34:54.8284679Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
2025-09-30T01:34:54.8285381Z     rec.execute(self)
2025-09-30T01:34:54.8285991Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
2025-09-30T01:34:54.8286708Z     util.preloaded.orm_persistence.save_obj(
2025-09-30T01:34:54.8287403Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
2025-09-30T01:34:54.8288111Z     _emit_insert_statements(
2025-09-30T01:34:54.8288880Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
2025-09-30T01:34:54.8289810Z     result = connection.execute(
2025-09-30T01:34:54.8290445Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1415: in execute
2025-09-30T01:34:54.8291099Z     return meth(
2025-09-30T01:34:54.8291755Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:523: in _execute_on_connection
2025-09-30T01:34:54.8292567Z     return connection._execute_clauseelement(
2025-09-30T01:34:54.8293354Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1637: in _execute_clauseelement
2025-09-30T01:34:54.8294315Z     ret = self._execute_context(
2025-09-30T01:34:54.8295098Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1842: in _execute_context
2025-09-30T01:34:54.8295941Z     return self._exec_single_context(
2025-09-30T01:34:54.8296675Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1982: in _exec_single_context
2025-09-30T01:34:54.8297404Z     self._handle_dbapi_exception(
2025-09-30T01:34:54.8298164Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2351: in _handle_dbapi_exception
2025-09-30T01:34:54.8299035Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-09-30T01:34:54.8300018Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1963: in _exec_single_context
2025-09-30T01:34:54.8300783Z     self.dialect.do_execute(
2025-09-30T01:34:54.8301450Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:943: in do_execute
2025-09-30T01:34:54.8302179Z     cursor.execute(statement, parameters)
2025-09-30T01:34:54.8302951Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
2025-09-30T01:34:54.8303746Z     self._adapt_connection.await_(
2025-09-30T01:34:54.8304511Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.8305529Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.8306148Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8306917Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.8307666Z     value = await result
2025-09-30T01:34:54.8307988Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.8308776Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
2025-09-30T01:34:54.8309769Z     self._handle_exception(error)
2025-09-30T01:34:54.8310587Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
2025-09-30T01:34:54.8311460Z     self._adapt_connection._handle_exception(error)
2025-09-30T01:34:54.8312315Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.8313141Z     raise translated_error from error
2025-09-30T01:34:54.8314304Z E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_username"
2025-09-30T01:34:54.8315476Z E   DETAIL:  Key (username)=(testuser) already exists.
2025-09-30T01:34:54.8317069Z E   [SQL: INSERT INTO users (email, username, password_hash, avatar_url, preferred_language, status, is_active, last_active, is_admin, current_room_id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::userstatus, $7::BOOLEAN, $8::TIMESTAMP WITH TIME ZONE, $9::BOOLEAN, $10::INTEGER) RETURNING users.id, users.created_at]
2025-09-30T01:34:54.8319404Z E   [parameters: ('user@example.com', 'testuser', '$2b$12$NxIQ.GNX527tipxO9yDXTOHP./wSI2SkYaMJKcFvpA7yTaAiR2a.q', None, 'en', 'AVAILABLE', True, datetime.datetime(2025, 9, 30, 1, 34, 46, 451953), False, None)]
2025-09-30T01:34:54.8320581Z E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-09-30T01:34:54.8321283Z _ ERROR at teardown of TestDatabaseConstraints.test_conversation_participant_constraints _
2025-09-30T01:34:54.8322283Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:811: in ping
2025-09-30T01:34:54.8323219Z     _ = self.await_(self._async_ping())
2025-09-30T01:34:54.8323561Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8324267Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.8325379Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.8325954Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8326713Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.8327419Z     value = await result
2025-09-30T01:34:54.8327698Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.8328429Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:820: in _async_ping
2025-09-30T01:34:54.8329410Z     await tr.start()
2025-09-30T01:34:54.8330015Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/transaction.py:107: in start
2025-09-30T01:34:54.8330706Z     raise apg_errors.InterfaceError(
2025-09-30T01:34:54.8331379Z E   asyncpg.exceptions._base.InterfaceError: cannot use Connection.transaction() in a manually started transaction
2025-09-30T01:34:54.8331960Z 
2025-09-30T01:34:54.8332228Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.8333013Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:145: in __init__
2025-09-30T01:34:54.8333750Z     self._dbapi_connection = engine.raw_connection()
2025-09-30T01:34:54.8334205Z                              ^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8334951Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:3297: in raw_connection
2025-09-30T01:34:54.8335660Z     return self.pool.connect()
2025-09-30T01:34:54.8335961Z            ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8336573Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:449: in connect
2025-09-30T01:34:54.8337254Z     return _ConnectionFairy._checkout(self)
2025-09-30T01:34:54.8337628Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8338304Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:1363: in _checkout
2025-09-30T01:34:54.8338968Z     with util.safe_reraise():
2025-09-30T01:34:54.8339406Z          ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8340086Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
2025-09-30T01:34:54.8340809Z     raise exc_value.with_traceback(exc_tb)
2025-09-30T01:34:54.8341458Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:1301: in _checkout
2025-09-30T01:34:54.8342160Z     result = pool._dialect._do_ping_w_event(
2025-09-30T01:34:54.8342876Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:720: in _do_ping_w_event
2025-09-30T01:34:54.8343611Z     return self.do_ping(dbapi_connection)
2025-09-30T01:34:54.8343969Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8344728Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:1163: in do_ping
2025-09-30T01:34:54.8345510Z     dbapi_connection.ping()
2025-09-30T01:34:54.8346260Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:813: in ping
2025-09-30T01:34:54.8347025Z     self._handle_exception(error)
2025-09-30T01:34:54.8347837Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.8348683Z     raise translated_error from error
2025-09-30T01:34:54.8349927Z E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot use Connection.transaction() in a manually started transaction
2025-09-30T01:34:54.8351120Z 
2025-09-30T01:34:54.8351366Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.8352194Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytest_asyncio/plugin.py:347: in finalizer
2025-09-30T01:34:54.8353078Z     event_loop.run_until_complete(task)
2025-09-30T01:34:54.8353703Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:725: in run_until_complete
2025-09-30T01:34:54.8354391Z     return future.result()
2025-09-30T01:34:54.8354693Z            ^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8355373Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytest_asyncio/plugin.py:338: in async_finalizer
2025-09-30T01:34:54.8356209Z     await gen_obj.__anext__()  # type: ignore[union-attr]
2025-09-30T01:34:54.8356610Z     ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8356966Z tests/e2e/conftest.py:76: in async_db_session
2025-09-30T01:34:54.8357383Z     async with async_engine.begin() as conn:
2025-09-30T01:34:54.8357761Z                ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8358307Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/contextlib.py:214: in __aenter__
2025-09-30T01:34:54.8358898Z     return await anext(self.gen)
2025-09-30T01:34:54.8359378Z            ^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8360093Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/engine.py:1066: in begin
2025-09-30T01:34:54.8360799Z     async with conn:
2025-09-30T01:34:54.8361068Z                ^^^^
2025-09-30T01:34:54.8361698Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/base.py:121: in __aenter__
2025-09-30T01:34:54.8362537Z     return await self.start(is_ctxmanager=True)
2025-09-30T01:34:54.8362920Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8363652Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/engine.py:274: in start
2025-09-30T01:34:54.8364427Z     await greenlet_spawn(self.sync_engine.connect)
2025-09-30T01:34:54.8365264Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
2025-09-30T01:34:54.8366076Z     result = context.switch(value)
2025-09-30T01:34:54.8366429Z              ^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8367099Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:3273: in connect
2025-09-30T01:34:54.8367798Z     return self._connection_cls(self)
2025-09-30T01:34:54.8368131Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8368805Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:147: in __init__
2025-09-30T01:34:54.8372028Z     Connection._handle_dbapi_exception_noconnection(
2025-09-30T01:34:54.8372953Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2436: in _handle_dbapi_exception_noconnection
2025-09-30T01:34:54.8373910Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-09-30T01:34:54.8374697Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:145: in __init__
2025-09-30T01:34:54.8375429Z     self._dbapi_connection = engine.raw_connection()
2025-09-30T01:34:54.8375850Z                              ^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8376553Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:3297: in raw_connection
2025-09-30T01:34:54.8377297Z     return self.pool.connect()
2025-09-30T01:34:54.8377617Z            ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8378232Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:449: in connect
2025-09-30T01:34:54.8378924Z     return _ConnectionFairy._checkout(self)
2025-09-30T01:34:54.8379422Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8380293Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:1363: in _checkout
2025-09-30T01:34:54.8381005Z     with util.safe_reraise():
2025-09-30T01:34:54.8381316Z          ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8382158Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
2025-09-30T01:34:54.8382943Z     raise exc_value.with_traceback(exc_tb)
2025-09-30T01:34:54.8383656Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:1301: in _checkout
2025-09-30T01:34:54.8384348Z     result = pool._dialect._do_ping_w_event(
2025-09-30T01:34:54.8385121Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:720: in _do_ping_w_event
2025-09-30T01:34:54.8385917Z     return self.do_ping(dbapi_connection)
2025-09-30T01:34:54.8386277Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8387099Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:1163: in do_ping
2025-09-30T01:34:54.8387955Z     dbapi_connection.ping()
2025-09-30T01:34:54.8388749Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:813: in ping
2025-09-30T01:34:54.8389682Z     self._handle_exception(error)
2025-09-30T01:34:54.8390519Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.8391299Z     raise translated_error from error
2025-09-30T01:34:54.8392452Z E   sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot use Connection.transaction() in a manually started transaction
2025-09-30T01:34:54.8393776Z E   (Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-09-30T01:34:54.8394427Z ________ ERROR at setup of TestDatabaseConstraints.test_enum_validation ________
2025-09-30T01:34:54.8395477Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:545: in _prepare_and_execute
2025-09-30T01:34:54.8396424Z     self._rows = deque(await prepared_stmt.fetch(*parameters))
2025-09-30T01:34:54.8396886Z                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8397575Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
2025-09-30T01:34:54.8398322Z     data = await self.__bind_execute(args, 0, timeout)
2025-09-30T01:34:54.8398735Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8399633Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
2025-09-30T01:34:54.8400347Z     data, status, _ = await self.__do_execute(
2025-09-30T01:34:54.8401049Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
2025-09-30T01:34:54.8401749Z     return await executor(protocol)
2025-09-30T01:34:54.8402089Z            ^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8402494Z asyncpg/protocol/protocol.pyx:206: in bind_execute
2025-09-30T01:34:54.8402871Z     ???
2025-09-30T01:34:54.8403481Z E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_username"
2025-09-30T01:34:54.8404226Z E   DETAIL:  Key (username)=(testuser) already exists.
2025-09-30T01:34:54.8404521Z 
2025-09-30T01:34:54.8404762Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.8405665Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1963: in _exec_single_context
2025-09-30T01:34:54.8406450Z     self.dialect.do_execute(
2025-09-30T01:34:54.8407164Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:943: in do_execute
2025-09-30T01:34:54.8407916Z     cursor.execute(statement, parameters)
2025-09-30T01:34:54.8408860Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
2025-09-30T01:34:54.8409793Z     self._adapt_connection.await_(
2025-09-30T01:34:54.8410664Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.8411633Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.8412266Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8412956Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.8413688Z     value = await result
2025-09-30T01:34:54.8413977Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.8414745Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
2025-09-30T01:34:54.8415548Z     self._handle_exception(error)
2025-09-30T01:34:54.8416326Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
2025-09-30T01:34:54.8417181Z     self._adapt_connection._handle_exception(error)
2025-09-30T01:34:54.8418087Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.8418967Z     raise translated_error from error
2025-09-30T01:34:54.8420299Z E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_username"
2025-09-30T01:34:54.8421545Z E   DETAIL:  Key (username)=(testuser) already exists.
2025-09-30T01:34:54.8421835Z 
2025-09-30T01:34:54.8422080Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.8422951Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytest_asyncio/plugin.py:375: in _async_fixture_wrapper
2025-09-30T01:34:54.8423779Z     result = event_loop.run_until_complete(setup_task)
2025-09-30T01:34:54.8424187Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8424850Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:725: in run_until_complete
2025-09-30T01:34:54.8425546Z     return future.result()
2025-09-30T01:34:54.8425851Z            ^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8426487Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytest_asyncio/plugin.py:370: in setup
2025-09-30T01:34:54.8427252Z     res = await func(**_add_kwargs(func, kwargs, event_loop, request))
2025-09-30T01:34:54.8427725Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8428115Z tests/e2e/conftest.py:160: in created_user
2025-09-30T01:34:54.8428504Z     await async_db_session.commit()
2025-09-30T01:34:54.8429438Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1014: in commit
2025-09-30T01:34:54.8430227Z     await greenlet_spawn(self.sync_session.commit)
2025-09-30T01:34:54.8431029Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
2025-09-30T01:34:54.8431836Z     result = context.switch(value)
2025-09-30T01:34:54.8432177Z              ^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8432827Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2032: in commit
2025-09-30T01:34:54.8433519Z     trans.commit(_to_root=True)
2025-09-30T01:34:54.8434165Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.8434846Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.8435192Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8435843Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1313: in commit
2025-09-30T01:34:54.8436664Z     self._prepare_impl()
2025-09-30T01:34:54.8437308Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.8438120Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.8438452Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8439547Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1288: in _prepare_impl
2025-09-30T01:34:54.8440270Z     self.session.flush()
2025-09-30T01:34:54.8440886Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4345: in flush
2025-09-30T01:34:54.8441555Z     self._flush(objects)
2025-09-30T01:34:54.8442161Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4480: in _flush
2025-09-30T01:34:54.8442836Z     with util.safe_reraise():
2025-09-30T01:34:54.8443159Z          ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8443838Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
2025-09-30T01:34:54.8444562Z     raise exc_value.with_traceback(exc_tb)
2025-09-30T01:34:54.8445254Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4441: in _flush
2025-09-30T01:34:54.8445904Z     flush_context.execute()
2025-09-30T01:34:54.8446546Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
2025-09-30T01:34:54.8447199Z     rec.execute(self)
2025-09-30T01:34:54.8447806Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
2025-09-30T01:34:54.8448545Z     util.preloaded.orm_persistence.save_obj(
2025-09-30T01:34:54.8449442Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
2025-09-30T01:34:54.8450170Z     _emit_insert_statements(
2025-09-30T01:34:54.8450943Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
2025-09-30T01:34:54.8451747Z     result = connection.execute(
2025-09-30T01:34:54.8452426Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1415: in execute
2025-09-30T01:34:54.8453106Z     return meth(
2025-09-30T01:34:54.8453768Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:523: in _execute_on_connection
2025-09-30T01:34:54.8454567Z     return connection._execute_clauseelement(
2025-09-30T01:34:54.8455359Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1637: in _execute_clauseelement
2025-09-30T01:34:54.8456118Z     ret = self._execute_context(
2025-09-30T01:34:54.8456808Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1842: in _execute_context
2025-09-30T01:34:54.8457562Z     return self._exec_single_context(
2025-09-30T01:34:54.8458281Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1982: in _exec_single_context
2025-09-30T01:34:54.8459033Z     self._handle_dbapi_exception(
2025-09-30T01:34:54.8459861Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2351: in _handle_dbapi_exception
2025-09-30T01:34:54.8460723Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-09-30T01:34:54.8461577Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1963: in _exec_single_context
2025-09-30T01:34:54.8462317Z     self.dialect.do_execute(
2025-09-30T01:34:54.8462993Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:943: in do_execute
2025-09-30T01:34:54.8463743Z     cursor.execute(statement, parameters)
2025-09-30T01:34:54.8464522Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
2025-09-30T01:34:54.8465520Z     self._adapt_connection.await_(
2025-09-30T01:34:54.8466257Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.8467411Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.8468005Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8468757Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.8469665Z     value = await result
2025-09-30T01:34:54.8469957Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.8470704Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
2025-09-30T01:34:54.8471529Z     self._handle_exception(error)
2025-09-30T01:34:54.8472364Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
2025-09-30T01:34:54.8473263Z     self._adapt_connection._handle_exception(error)
2025-09-30T01:34:54.8474165Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.8475026Z     raise translated_error from error
2025-09-30T01:34:54.8476210Z E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_username"
2025-09-30T01:34:54.8477479Z E   DETAIL:  Key (username)=(testuser) already exists.
2025-09-30T01:34:54.8479771Z E   [SQL: INSERT INTO users (email, username, password_hash, avatar_url, preferred_language, status, is_active, last_active, is_admin, current_room_id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::userstatus, $7::BOOLEAN, $8::TIMESTAMP WITH TIME ZONE, $9::BOOLEAN, $10::INTEGER) RETURNING users.id, users.created_at]
2025-09-30T01:34:54.8481986Z E   [parameters: ('user@example.com', 'testuser', '$2b$12$nT55XU0jHBuETVUIMEl9KuZe.usHUDo9WPAO.nM8u9ra1bNWNkujm', None, 'en', 'AVAILABLE', True, datetime.datetime(2025, 9, 30, 1, 34, 48, 688810), False, None)]
2025-09-30T01:34:54.8483198Z E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-09-30T01:34:54.8483835Z ____ ERROR at teardown of TestDatabaseConstraints.test_nullable_constraints ____
2025-09-30T01:34:54.8484789Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:811: in ping
2025-09-30T01:34:54.8485562Z     _ = self.await_(self._async_ping())
2025-09-30T01:34:54.8485901Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8486629Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.8487623Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.8488218Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8489089Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.8490010Z     value = await result
2025-09-30T01:34:54.8490304Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.8491068Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:820: in _async_ping
2025-09-30T01:34:54.8491861Z     await tr.start()
2025-09-30T01:34:54.8492457Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/transaction.py:107: in start
2025-09-30T01:34:54.8493113Z     raise apg_errors.InterfaceError(
2025-09-30T01:34:54.8493811Z E   asyncpg.exceptions._base.InterfaceError: cannot use Connection.transaction() in a manually started transaction
2025-09-30T01:34:54.8494542Z 
2025-09-30T01:34:54.8494798Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.8495566Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:145: in __init__
2025-09-30T01:34:54.8496427Z     self._dbapi_connection = engine.raw_connection()
2025-09-30T01:34:54.8496835Z                              ^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8497553Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:3297: in raw_connection
2025-09-30T01:34:54.8498289Z     return self.pool.connect()
2025-09-30T01:34:54.8498624Z            ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8499397Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:449: in connect
2025-09-30T01:34:54.8500115Z     return _ConnectionFairy._checkout(self)
2025-09-30T01:34:54.8500495Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8501169Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:1363: in _checkout
2025-09-30T01:34:54.8501895Z     with util.safe_reraise():
2025-09-30T01:34:54.8502202Z          ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8502920Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
2025-09-30T01:34:54.8503735Z     raise exc_value.with_traceback(exc_tb)
2025-09-30T01:34:54.8504454Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:1301: in _checkout
2025-09-30T01:34:54.8505174Z     result = pool._dialect._do_ping_w_event(
2025-09-30T01:34:54.8505939Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:720: in _do_ping_w_event
2025-09-30T01:34:54.8506676Z     return self.do_ping(dbapi_connection)
2025-09-30T01:34:54.8507032Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8507867Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:1163: in do_ping
2025-09-30T01:34:54.8508684Z     dbapi_connection.ping()
2025-09-30T01:34:54.8509551Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:813: in ping
2025-09-30T01:34:54.8510364Z     self._handle_exception(error)
2025-09-30T01:34:54.8511277Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.8512131Z     raise translated_error from error
2025-09-30T01:34:54.8513321Z E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot use Connection.transaction() in a manually started transaction
2025-09-30T01:34:54.8514439Z 
2025-09-30T01:34:54.8514703Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.8515554Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytest_asyncio/plugin.py:347: in finalizer
2025-09-30T01:34:54.8516282Z     event_loop.run_until_complete(task)
2025-09-30T01:34:54.8516936Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:725: in run_until_complete
2025-09-30T01:34:54.8517588Z     return future.result()
2025-09-30T01:34:54.8517894Z            ^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8518546Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytest_asyncio/plugin.py:338: in async_finalizer
2025-09-30T01:34:54.8519488Z     await gen_obj.__anext__()  # type: ignore[union-attr]
2025-09-30T01:34:54.8519879Z     ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8520216Z tests/e2e/conftest.py:76: in async_db_session
2025-09-30T01:34:54.8520648Z     async with async_engine.begin() as conn:
2025-09-30T01:34:54.8520994Z                ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8521543Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/contextlib.py:214: in __aenter__
2025-09-30T01:34:54.8522115Z     return await anext(self.gen)
2025-09-30T01:34:54.8522590Z            ^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8523250Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/engine.py:1066: in begin
2025-09-30T01:34:54.8524060Z     async with conn:
2025-09-30T01:34:54.8524327Z                ^^^^
2025-09-30T01:34:54.8524987Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/base.py:121: in __aenter__
2025-09-30T01:34:54.8525773Z     return await self.start(is_ctxmanager=True)
2025-09-30T01:34:54.8526182Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8526956Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/engine.py:274: in start
2025-09-30T01:34:54.8527767Z     await greenlet_spawn(self.sync_engine.connect)
2025-09-30T01:34:54.8528688Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
2025-09-30T01:34:54.8529613Z     result = context.switch(value)
2025-09-30T01:34:54.8529958Z              ^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8530642Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:3273: in connect
2025-09-30T01:34:54.8531345Z     return self._connection_cls(self)
2025-09-30T01:34:54.8531716Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8532426Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:147: in __init__
2025-09-30T01:34:54.8533237Z     Connection._handle_dbapi_exception_noconnection(
2025-09-30T01:34:54.8534205Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2436: in _handle_dbapi_exception_noconnection
2025-09-30T01:34:54.8535136Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-09-30T01:34:54.8535890Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:145: in __init__
2025-09-30T01:34:54.8536592Z     self._dbapi_connection = engine.raw_connection()
2025-09-30T01:34:54.8536960Z                              ^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8537643Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:3297: in raw_connection
2025-09-30T01:34:54.8538377Z     return self.pool.connect()
2025-09-30T01:34:54.8538702Z            ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8539478Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:449: in connect
2025-09-30T01:34:54.8540223Z     return _ConnectionFairy._checkout(self)
2025-09-30T01:34:54.8540603Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8541269Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:1363: in _checkout
2025-09-30T01:34:54.8541978Z     with util.safe_reraise():
2025-09-30T01:34:54.8542290Z          ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8542988Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
2025-09-30T01:34:54.8543792Z     raise exc_value.with_traceback(exc_tb)
2025-09-30T01:34:54.8544534Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:1301: in _checkout
2025-09-30T01:34:54.8545208Z     result = pool._dialect._do_ping_w_event(
2025-09-30T01:34:54.8545960Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:720: in _do_ping_w_event
2025-09-30T01:34:54.8546734Z     return self.do_ping(dbapi_connection)
2025-09-30T01:34:54.8547113Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8547889Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:1163: in do_ping
2025-09-30T01:34:54.8548684Z     dbapi_connection.ping()
2025-09-30T01:34:54.8549536Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:813: in ping
2025-09-30T01:34:54.8550519Z     self._handle_exception(error)
2025-09-30T01:34:54.8551373Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.8552376Z     raise translated_error from error
2025-09-30T01:34:54.8553577Z E   sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot use Connection.transaction() in a manually started transaction
2025-09-30T01:34:54.8555008Z E   (Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-09-30T01:34:54.8555568Z ---------------------------- Captured log teardown -----------------------------
2025-09-30T01:34:54.8556095Z ERROR    asyncio:base_events.py:1879 Future exception was never retrieved
2025-09-30T01:34:54.8557035Z future: <Future finished exception=NotNullViolationError('null value in column "email" of relation "users" violates not-null constraint')>
2025-09-30T01:34:54.8558109Z asyncpg.exceptions.NotNullViolationError: null value in column "email" of relation "users" violates not-null constraint
2025-09-30T01:34:54.8559660Z DETAIL:  Failing row contains (2, null, testuser, $2b$12$vqk30WxgUiW48mxTwyhTQux9f83GwkN.xzo3BkeWoplQf4emvUDHK, null, en, AVAILABLE, t, 2025-09-30 01:34:49.463713+00, 2025-09-30 01:34:49.718755+00, f, null).
2025-09-30T01:34:54.8560818Z _______ ERROR at setup of TestDatabaseConstraints.test_cascading_deletes _______
2025-09-30T01:34:54.8561862Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:545: in _prepare_and_execute
2025-09-30T01:34:54.8562834Z     self._rows = deque(await prepared_stmt.fetch(*parameters))
2025-09-30T01:34:54.8563304Z                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8564014Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:176: in fetch
2025-09-30T01:34:54.8564750Z     data = await self.__bind_execute(args, 0, timeout)
2025-09-30T01:34:54.8565178Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8565915Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:267: in __bind_execute
2025-09-30T01:34:54.8566708Z     data, status, _ = await self.__do_execute(
2025-09-30T01:34:54.8567471Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/prepared_stmt.py:256: in __do_execute
2025-09-30T01:34:54.8568235Z     return await executor(protocol)
2025-09-30T01:34:54.8568547Z            ^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8568919Z asyncpg/protocol/protocol.pyx:206: in bind_execute
2025-09-30T01:34:54.8569441Z     ???
2025-09-30T01:34:54.8570082Z E   asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "ix_users_username"
2025-09-30T01:34:54.8570899Z E   DETAIL:  Key (username)=(testuser) already exists.
2025-09-30T01:34:54.8571441Z 
2025-09-30T01:34:54.8571871Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.8573600Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1963: in _exec_single_context
2025-09-30T01:34:54.8575018Z     self.dialect.do_execute(
2025-09-30T01:34:54.8576161Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:943: in do_execute
2025-09-30T01:34:54.8577543Z     cursor.execute(statement, parameters)
2025-09-30T01:34:54.8579103Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
2025-09-30T01:34:54.8581456Z     self._adapt_connection.await_(
2025-09-30T01:34:54.8582856Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.8584687Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.8585827Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8587386Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.8588707Z     value = await result
2025-09-30T01:34:54.8589513Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.8590928Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
2025-09-30T01:34:54.8592407Z     self._handle_exception(error)
2025-09-30T01:34:54.8593845Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
2025-09-30T01:34:54.8595439Z     self._adapt_connection._handle_exception(error)
2025-09-30T01:34:54.8597020Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.8598535Z     raise translated_error from error
2025-09-30T01:34:54.8600782Z E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_username"
2025-09-30T01:34:54.8605584Z E   DETAIL:  Key (username)=(testuser) already exists.
2025-09-30T01:34:54.8606123Z 
2025-09-30T01:34:54.8606527Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.8607976Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytest_asyncio/plugin.py:375: in _async_fixture_wrapper
2025-09-30T01:34:54.8609546Z     result = event_loop.run_until_complete(setup_task)
2025-09-30T01:34:54.8610214Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8611401Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:725: in run_until_complete
2025-09-30T01:34:54.8612630Z     return future.result()
2025-09-30T01:34:54.8613098Z            ^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8614044Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytest_asyncio/plugin.py:370: in setup
2025-09-30T01:34:54.8615383Z     res = await func(**_add_kwargs(func, kwargs, event_loop, request))
2025-09-30T01:34:54.8616215Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8616922Z tests/e2e/conftest.py:160: in created_user
2025-09-30T01:34:54.8617582Z     await async_db_session.commit()
2025-09-30T01:34:54.8618850Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1014: in commit
2025-09-30T01:34:54.8620657Z     await greenlet_spawn(self.sync_session.commit)
2025-09-30T01:34:54.8622231Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
2025-09-30T01:34:54.8623628Z     result = context.switch(value)
2025-09-30T01:34:54.8624059Z              ^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8624944Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2032: in commit
2025-09-30T01:34:54.8625920Z     trans.commit(_to_root=True)
2025-09-30T01:34:54.8626888Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.8627964Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.8628405Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8629476Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1313: in commit
2025-09-30T01:34:54.8630471Z     self._prepare_impl()
2025-09-30T01:34:54.8631433Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.8632463Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.8632924Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8633925Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1288: in _prepare_impl
2025-09-30T01:34:54.8635171Z     self.session.flush()
2025-09-30T01:34:54.8636007Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4345: in flush
2025-09-30T01:34:54.8636929Z     self._flush(objects)
2025-09-30T01:34:54.8637905Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4480: in _flush
2025-09-30T01:34:54.8638888Z     with util.safe_reraise():
2025-09-30T01:34:54.8639477Z          ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8640436Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
2025-09-30T01:34:54.8641466Z     raise exc_value.with_traceback(exc_tb)
2025-09-30T01:34:54.8642468Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4441: in _flush
2025-09-30T01:34:54.8643407Z     flush_context.execute()
2025-09-30T01:34:54.8644303Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
2025-09-30T01:34:54.8645363Z     rec.execute(self)
2025-09-30T01:34:54.8646249Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
2025-09-30T01:34:54.8647254Z     util.preloaded.orm_persistence.save_obj(
2025-09-30T01:34:54.8648337Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
2025-09-30T01:34:54.8649485Z     _emit_insert_statements(
2025-09-30T01:34:54.8650627Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
2025-09-30T01:34:54.8651727Z     result = connection.execute(
2025-09-30T01:34:54.8652747Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1415: in execute
2025-09-30T01:34:54.8653612Z     return meth(
2025-09-30T01:34:54.8654578Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:523: in _execute_on_connection
2025-09-30T01:34:54.8655753Z     return connection._execute_clauseelement(
2025-09-30T01:34:54.8657060Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1637: in _execute_clauseelement
2025-09-30T01:34:54.8658007Z     ret = self._execute_context(
2025-09-30T01:34:54.8658998Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1842: in _execute_context
2025-09-30T01:34:54.8660266Z     return self._exec_single_context(
2025-09-30T01:34:54.8661351Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1982: in _exec_single_context
2025-09-30T01:34:54.8662445Z     self._handle_dbapi_exception(
2025-09-30T01:34:54.8663663Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2351: in _handle_dbapi_exception
2025-09-30T01:34:54.8664912Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-09-30T01:34:54.8666178Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1963: in _exec_single_context
2025-09-30T01:34:54.8667371Z     self.dialect.do_execute(
2025-09-30T01:34:54.8668310Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:943: in do_execute
2025-09-30T01:34:54.8669508Z     cursor.execute(statement, parameters)
2025-09-30T01:34:54.8670792Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
2025-09-30T01:34:54.8672195Z     self._adapt_connection.await_(
2025-09-30T01:34:54.8673751Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.8675679Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.8676895Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8678700Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.8680846Z     value = await result
2025-09-30T01:34:54.8681477Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.8683523Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
2025-09-30T01:34:54.8685584Z     self._handle_exception(error)
2025-09-30T01:34:54.8687497Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
2025-09-30T01:34:54.8689718Z     self._adapt_connection._handle_exception(error)
2025-09-30T01:34:54.8691786Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.8693815Z     raise translated_error from error
2025-09-30T01:34:54.8696694Z E   sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_username"
2025-09-30T01:34:54.8699839Z E   DETAIL:  Key (username)=(testuser) already exists.
2025-09-30T01:34:54.8703573Z E   [SQL: INSERT INTO users (email, username, password_hash, avatar_url, preferred_language, status, is_active, last_active, is_admin, current_room_id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::userstatus, $7::BOOLEAN, $8::TIMESTAMP WITH TIME ZONE, $9::BOOLEAN, $10::INTEGER) RETURNING users.id, users.created_at]
2025-09-30T01:34:54.8708808Z E   [parameters: ('user@example.com', 'testuser', '$2b$12$BGFzZsF4tNm7.hmvv1w96.i.Rxf5vzFIXX5VL73oGmZBZvpwkaFWe', None, 'en', 'AVAILABLE', True, datetime.datetime(2025, 9, 30, 1, 34, 50, 617443), False, None)]
2025-09-30T01:34:54.8711645Z E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-09-30T01:34:54.8712714Z =================================== FAILURES ===================================
2025-09-30T01:34:54.8714011Z _____________ TestCriticalUserJourneys.test_complete_chat_workflow _____________
2025-09-30T01:34:54.8715580Z tests/e2e/test_critical_workflows.py:24: in test_complete_chat_workflow
2025-09-30T01:34:54.8716491Z     room_response = await async_client.post(
2025-09-30T01:34:54.8717086Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1859: in post
2025-09-30T01:34:54.8719493Z     return await self.request(
2025-09-30T01:34:54.8720196Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1540: in request
2025-09-30T01:34:54.8721075Z     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-09-30T01:34:54.8721971Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8723120Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1629: in send
2025-09-30T01:34:54.8724244Z     response = await self._send_handling_auth(
2025-09-30T01:34:54.8725553Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
2025-09-30T01:34:54.8726914Z     response = await self._send_handling_redirects(
2025-09-30T01:34:54.8728335Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
2025-09-30T01:34:54.8729886Z     response = await self._send_single_request(request)
2025-09-30T01:34:54.8730577Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8731807Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
2025-09-30T01:34:54.8733220Z     response = await transport.handle_async_request(request)
2025-09-30T01:34:54.8733985Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8735310Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
2025-09-30T01:34:54.8736919Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.8738174Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/applications.py:1054: in __call__
2025-09-30T01:34:54.8767130Z     await super().__call__(scope, receive, send)
2025-09-30T01:34:54.8767962Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/applications.py:112: in __call__
2025-09-30T01:34:54.8768709Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.8769675Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:187: in __call__
2025-09-30T01:34:54.8770359Z     raise exc
2025-09-30T01:34:54.8770983Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:165: in __call__
2025-09-30T01:34:54.8771729Z     await self.app(scope, receive, _send)
2025-09-30T01:34:54.8772477Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/exceptions.py:62: in __call__
2025-09-30T01:34:54.8773404Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-09-30T01:34:54.8774277Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.8775009Z     raise exc
2025-09-30T01:34:54.8775648Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.8776374Z     await app(scope, receive, sender)
2025-09-30T01:34:54.8777029Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:714: in __call__
2025-09-30T01:34:54.8777760Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.8778455Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:734: in app
2025-09-30T01:34:54.8780020Z     await route.handle(scope, receive, send)
2025-09-30T01:34:54.8780726Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:288: in handle
2025-09-30T01:34:54.8781330Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.8781939Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:76: in app
2025-09-30T01:34:54.8782742Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-09-30T01:34:54.8783583Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.8784285Z     raise exc
2025-09-30T01:34:54.8784900Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.8785648Z     await app(scope, receive, sender)
2025-09-30T01:34:54.8786292Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:73: in app
2025-09-30T01:34:54.8786939Z     response = await f(request)
2025-09-30T01:34:54.8787267Z                ^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8787877Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/routing.py:291: in app
2025-09-30T01:34:54.8788498Z     solved_result = await solve_dependencies(
2025-09-30T01:34:54.8789430Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/dependencies/utils.py:615: in solve_dependencies
2025-09-30T01:34:54.8790260Z     solved_result = await solve_dependencies(
2025-09-30T01:34:54.8791014Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/dependencies/utils.py:615: in solve_dependencies
2025-09-30T01:34:54.8791797Z     solved_result = await solve_dependencies(
2025-09-30T01:34:54.8792540Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/dependencies/utils.py:638: in solve_dependencies
2025-09-30T01:34:54.8793357Z     solved = await call(**solved_result.values)
2025-09-30T01:34:54.8793725Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8794383Z app/core/auth_dependencies.py:41: in get_current_user
2025-09-30T01:34:54.8794844Z     user = await user_repo.get_by_username(username)
2025-09-30T01:34:54.8795257Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8795774Z app/repositories/user_repository.py:70: in get_by_username
2025-09-30T01:34:54.8796237Z     result = await self.db.execute(query)
2025-09-30T01:34:54.8796594Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8797300Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:463: in execute
2025-09-30T01:34:54.8798059Z     result = await greenlet_spawn(
2025-09-30T01:34:54.8798900Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
2025-09-30T01:34:54.8799928Z     result = context.throw(*sys.exc_info())
2025-09-30T01:34:54.8800305Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8800941Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-09-30T01:34:54.8801640Z     return self._execute_internal(
2025-09-30T01:34:54.8802376Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-09-30T01:34:54.8803195Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-09-30T01:34:54.8804047Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-09-30T01:34:54.8804795Z     result = conn.execute(
2025-09-30T01:34:54.8805412Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1415: in execute
2025-09-30T01:34:54.8806059Z     return meth(
2025-09-30T01:34:54.8806702Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:523: in _execute_on_connection
2025-09-30T01:34:54.8807510Z     return connection._execute_clauseelement(
2025-09-30T01:34:54.8808305Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1637: in _execute_clauseelement
2025-09-30T01:34:54.8809104Z     ret = self._execute_context(
2025-09-30T01:34:54.8810404Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1842: in _execute_context
2025-09-30T01:34:54.8811151Z     return self._exec_single_context(
2025-09-30T01:34:54.8811890Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1982: in _exec_single_context
2025-09-30T01:34:54.8812651Z     self._handle_dbapi_exception(
2025-09-30T01:34:54.8813404Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2354: in _handle_dbapi_exception
2025-09-30T01:34:54.8814239Z     raise exc_info[1].with_traceback(exc_info[2])
2025-09-30T01:34:54.8815015Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1963: in _exec_single_context
2025-09-30T01:34:54.8815790Z     self.dialect.do_execute(
2025-09-30T01:34:54.8816493Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:943: in do_execute
2025-09-30T01:34:54.8817268Z     cursor.execute(statement, parameters)
2025-09-30T01:34:54.8818104Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
2025-09-30T01:34:54.8818924Z     self._adapt_connection.await_(
2025-09-30T01:34:54.8819927Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.8821054Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.8821678Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8822452Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.8823393Z     value = await result
2025-09-30T01:34:54.8823722Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.8824562Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
2025-09-30T01:34:54.8825555Z     self._handle_exception(error)
2025-09-30T01:34:54.8826422Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
2025-09-30T01:34:54.8827462Z     self._adapt_connection._handle_exception(error)
2025-09-30T01:34:54.8828336Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:794: in _handle_exception
2025-09-30T01:34:54.8829309Z     raise error
2025-09-30T01:34:54.8830117Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:521: in _prepare_and_execute
2025-09-30T01:34:54.8831128Z     prepared_stmt, attributes = await adapt_connection._prepare(
2025-09-30T01:34:54.8832053Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:768: in _prepare
2025-09-30T01:34:54.8832892Z     prepared_stmt = await self._connection.prepare(
2025-09-30T01:34:54.8833621Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:635: in prepare
2025-09-30T01:34:54.8834289Z     return await self._prepare(
2025-09-30T01:34:54.8834938Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:653: in _prepare
2025-09-30T01:34:54.8835624Z     stmt = await self._get_statement(
2025-09-30T01:34:54.8836327Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:432: in _get_statement
2025-09-30T01:34:54.8837068Z     statement = await self._protocol.prepare(
2025-09-30T01:34:54.8837501Z asyncpg/protocol/protocol.pyx:165: in prepare
2025-09-30T01:34:54.8837857Z     ???
2025-09-30T01:34:54.8840238Z E   RuntimeError: Task <Task pending name='Task-8' coro=<TestCriticalUserJourneys.test_complete_chat_workflow() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_critical_workflows.py:24> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.8842896Z _____________ TestCriticalUserJourneys.test_room_closure_workflow ______________
2025-09-30T01:34:54.8843573Z tests/e2e/test_critical_workflows.py:95: in test_room_closure_workflow
2025-09-30T01:34:54.8844139Z     room_response = await async_client.post(
2025-09-30T01:34:54.8844777Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1859: in post
2025-09-30T01:34:54.8845487Z     return await self.request(
2025-09-30T01:34:54.8846143Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1540: in request
2025-09-30T01:34:54.8847047Z     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-09-30T01:34:54.8847614Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8848233Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1629: in send
2025-09-30T01:34:54.8848909Z     response = await self._send_handling_auth(
2025-09-30T01:34:54.8849762Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
2025-09-30T01:34:54.8850465Z     response = await self._send_handling_redirects(
2025-09-30T01:34:54.8851202Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
2025-09-30T01:34:54.8851954Z     response = await self._send_single_request(request)
2025-09-30T01:34:54.8852370Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8853267Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
2025-09-30T01:34:54.8854069Z     response = await transport.handle_async_request(request)
2025-09-30T01:34:54.8854616Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8855399Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
2025-09-30T01:34:54.8856203Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.8856949Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/applications.py:1054: in __call__
2025-09-30T01:34:54.8857694Z     await super().__call__(scope, receive, send)
2025-09-30T01:34:54.8858375Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/applications.py:112: in __call__
2025-09-30T01:34:54.8859077Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.8860084Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:187: in __call__
2025-09-30T01:34:54.8860794Z     raise exc
2025-09-30T01:34:54.8861435Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:165: in __call__
2025-09-30T01:34:54.8862167Z     await self.app(scope, receive, _send)
2025-09-30T01:34:54.8862893Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/exceptions.py:62: in __call__
2025-09-30T01:34:54.8863860Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-09-30T01:34:54.8864799Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.8865544Z     raise exc
2025-09-30T01:34:54.8866191Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.8866960Z     await app(scope, receive, sender)
2025-09-30T01:34:54.8867687Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:714: in __call__
2025-09-30T01:34:54.8868375Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.8869044Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:734: in app
2025-09-30T01:34:54.8869835Z     await route.handle(scope, receive, send)
2025-09-30T01:34:54.8870454Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:288: in handle
2025-09-30T01:34:54.8871100Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.8871710Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:76: in app
2025-09-30T01:34:54.8872429Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-09-30T01:34:54.8873260Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.8874012Z     raise exc
2025-09-30T01:34:54.8874651Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.8875404Z     await app(scope, receive, sender)
2025-09-30T01:34:54.8876055Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:73: in app
2025-09-30T01:34:54.8876728Z     response = await f(request)
2025-09-30T01:34:54.8877022Z                ^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8877546Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/routing.py:291: in app
2025-09-30T01:34:54.8878169Z     solved_result = await solve_dependencies(
2025-09-30T01:34:54.8878991Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/dependencies/utils.py:615: in solve_dependencies
2025-09-30T01:34:54.8880000Z     solved_result = await solve_dependencies(
2025-09-30T01:34:54.8880826Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/dependencies/utils.py:615: in solve_dependencies
2025-09-30T01:34:54.8881830Z     solved_result = await solve_dependencies(
2025-09-30T01:34:54.8882625Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/dependencies/utils.py:638: in solve_dependencies
2025-09-30T01:34:54.8883539Z     solved = await call(**solved_result.values)
2025-09-30T01:34:54.8883905Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8884338Z app/core/auth_dependencies.py:41: in get_current_user
2025-09-30T01:34:54.8884815Z     user = await user_repo.get_by_username(username)
2025-09-30T01:34:54.8885208Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8885644Z app/repositories/user_repository.py:70: in get_by_username
2025-09-30T01:34:54.8886097Z     result = await self.db.execute(query)
2025-09-30T01:34:54.8886454Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8887168Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:463: in execute
2025-09-30T01:34:54.8887968Z     result = await greenlet_spawn(
2025-09-30T01:34:54.8888748Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
2025-09-30T01:34:54.8889738Z     result = context.throw(*sys.exc_info())
2025-09-30T01:34:54.8890113Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8890774Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-09-30T01:34:54.8891461Z     return self._execute_internal(
2025-09-30T01:34:54.8892168Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-09-30T01:34:54.8893016Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-09-30T01:34:54.8893898Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-09-30T01:34:54.8894679Z     result = conn.execute(
2025-09-30T01:34:54.8895309Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1415: in execute
2025-09-30T01:34:54.8895982Z     return meth(
2025-09-30T01:34:54.8896674Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:523: in _execute_on_connection
2025-09-30T01:34:54.8897493Z     return connection._execute_clauseelement(
2025-09-30T01:34:54.8898305Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1637: in _execute_clauseelement
2025-09-30T01:34:54.8899070Z     ret = self._execute_context(
2025-09-30T01:34:54.8899929Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1842: in _execute_context
2025-09-30T01:34:54.8900678Z     return self._exec_single_context(
2025-09-30T01:34:54.8901401Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1982: in _exec_single_context
2025-09-30T01:34:54.8902131Z     self._handle_dbapi_exception(
2025-09-30T01:34:54.8902887Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2354: in _handle_dbapi_exception
2025-09-30T01:34:54.8903728Z     raise exc_info[1].with_traceback(exc_info[2])
2025-09-30T01:34:54.8904509Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1963: in _exec_single_context
2025-09-30T01:34:54.8905283Z     self.dialect.do_execute(
2025-09-30T01:34:54.8905968Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:943: in do_execute
2025-09-30T01:34:54.8906711Z     cursor.execute(statement, parameters)
2025-09-30T01:34:54.8907516Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
2025-09-30T01:34:54.8908304Z     self._adapt_connection.await_(
2025-09-30T01:34:54.8909046Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.8910390Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.8910987Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8911857Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.8912600Z     value = await result
2025-09-30T01:34:54.8912874Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.8913608Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
2025-09-30T01:34:54.8914457Z     self._handle_exception(error)
2025-09-30T01:34:54.8915282Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
2025-09-30T01:34:54.8916159Z     self._adapt_connection._handle_exception(error)
2025-09-30T01:34:54.8917058Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:794: in _handle_exception
2025-09-30T01:34:54.8917865Z     raise error
2025-09-30T01:34:54.8918657Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:521: in _prepare_and_execute
2025-09-30T01:34:54.8919765Z     prepared_stmt, attributes = await adapt_connection._prepare(
2025-09-30T01:34:54.8920682Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:768: in _prepare
2025-09-30T01:34:54.8921503Z     prepared_stmt = await self._connection.prepare(
2025-09-30T01:34:54.8922191Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:635: in prepare
2025-09-30T01:34:54.8922880Z     return await self._prepare(
2025-09-30T01:34:54.8923505Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:653: in _prepare
2025-09-30T01:34:54.8924187Z     stmt = await self._get_statement(
2025-09-30T01:34:54.8924821Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:432: in _get_statement
2025-09-30T01:34:54.8925554Z     statement = await self._protocol.prepare(
2025-09-30T01:34:54.8925959Z asyncpg/protocol/protocol.pyx:165: in prepare
2025-09-30T01:34:54.8926403Z     ???
2025-09-30T01:34:54.8928541Z E   RuntimeError: Task <Task pending name='Task-20' coro=<TestCriticalUserJourneys.test_room_closure_workflow() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_critical_workflows.py:95> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.8931070Z ____________ TestCriticalUserJourneys.test_authentication_security _____________
2025-09-30T01:34:54.8931881Z tests/e2e/test_critical_workflows.py:146: in test_authentication_security
2025-09-30T01:34:54.8932638Z     register_response = await async_client.post("/api/v1/auth/register", json=sample_user_data)
2025-09-30T01:34:54.8933219Z                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8933908Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1859: in post
2025-09-30T01:34:54.8934541Z     return await self.request(
2025-09-30T01:34:54.8935153Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1540: in request
2025-09-30T01:34:54.8935963Z     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-09-30T01:34:54.8936489Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8937151Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1629: in send
2025-09-30T01:34:54.8937976Z     response = await self._send_handling_auth(
2025-09-30T01:34:54.8938676Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
2025-09-30T01:34:54.8939568Z     response = await self._send_handling_redirects(
2025-09-30T01:34:54.8940416Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
2025-09-30T01:34:54.8941214Z     response = await self._send_single_request(request)
2025-09-30T01:34:54.8941628Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8942339Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
2025-09-30T01:34:54.8943166Z     response = await transport.handle_async_request(request)
2025-09-30T01:34:54.8943598Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8944362Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
2025-09-30T01:34:54.8945135Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.8945832Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/applications.py:1054: in __call__
2025-09-30T01:34:54.8946560Z     await super().__call__(scope, receive, send)
2025-09-30T01:34:54.8947248Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/applications.py:112: in __call__
2025-09-30T01:34:54.8948017Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.8948800Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:187: in __call__
2025-09-30T01:34:54.8949637Z     raise exc
2025-09-30T01:34:54.8950250Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:165: in __call__
2025-09-30T01:34:54.8951014Z     await self.app(scope, receive, _send)
2025-09-30T01:34:54.8951775Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/exceptions.py:62: in __call__
2025-09-30T01:34:54.8952701Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-09-30T01:34:54.8953606Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.8954324Z     raise exc
2025-09-30T01:34:54.8954988Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.8955794Z     await app(scope, receive, sender)
2025-09-30T01:34:54.8956497Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:714: in __call__
2025-09-30T01:34:54.8957233Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.8957909Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:734: in app
2025-09-30T01:34:54.8958602Z     await route.handle(scope, receive, send)
2025-09-30T01:34:54.8959394Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:288: in handle
2025-09-30T01:34:54.8960088Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.8960768Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:76: in app
2025-09-30T01:34:54.8961567Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-09-30T01:34:54.8962467Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.8963251Z     raise exc
2025-09-30T01:34:54.8963894Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.8964645Z     await app(scope, receive, sender)
2025-09-30T01:34:54.8965291Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:73: in app
2025-09-30T01:34:54.8965958Z     response = await f(request)
2025-09-30T01:34:54.8966435Z                ^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.8967069Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/routing.py:301: in app
2025-09-30T01:34:54.8967740Z     raw_response = await run_endpoint_function(
2025-09-30T01:34:54.8968586Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/routing.py:212: in run_endpoint_function
2025-09-30T01:34:54.8969461Z     return await dependant.call(**values)
2025-09-30T01:34:54.8969809Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9004929Z app/api/v1/endpoints/auth_router.py:28: in register_user
2025-09-30T01:34:54.9005532Z     if await user_repo.email_exists(user_data.email):
2025-09-30T01:34:54.9006176Z        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9006618Z app/repositories/user_repository.py:120: in email_exists
2025-09-30T01:34:54.9007109Z     user = await self.get_by_email(email)
2025-09-30T01:34:54.9007515Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9007919Z app/repositories/user_repository.py:64: in get_by_email
2025-09-30T01:34:54.9008354Z     result = await self.db.execute(query)
2025-09-30T01:34:54.9008666Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9009598Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:463: in execute
2025-09-30T01:34:54.9010286Z     result = await greenlet_spawn(
2025-09-30T01:34:54.9011032Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
2025-09-30T01:34:54.9011820Z     result = context.throw(*sys.exc_info())
2025-09-30T01:34:54.9012157Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9012785Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-09-30T01:34:54.9013466Z     return self._execute_internal(
2025-09-30T01:34:54.9014226Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2241: in _execute_internal
2025-09-30T01:34:54.9015036Z     conn = self._connection_for_bind(bind)
2025-09-30T01:34:54.9015415Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9016165Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2110: in _connection_for_bind
2025-09-30T01:34:54.9017046Z     return trans._connection_for_bind(engine, execution_options)
2025-09-30T01:34:54.9017499Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9017852Z <string>:2: in _connection_for_bind
2025-09-30T01:34:54.9018144Z     ???
2025-09-30T01:34:54.9018688Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.9019533Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.9019869Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9020616Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1189: in _connection_for_bind
2025-09-30T01:34:54.9022050Z     conn = bind.connect()
2025-09-30T01:34:54.9022562Z            ^^^^^^^^^^^^^^
2025-09-30T01:34:54.9023633Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:3273: in connect
2025-09-30T01:34:54.9024938Z     return self._connection_cls(self)
2025-09-30T01:34:54.9025449Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9026717Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:145: in __init__
2025-09-30T01:34:54.9028099Z     self._dbapi_connection = engine.raw_connection()
2025-09-30T01:34:54.9028827Z                              ^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9030236Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:3297: in raw_connection
2025-09-30T01:34:54.9031578Z     return self.pool.connect()
2025-09-30T01:34:54.9032078Z            ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9033398Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:449: in connect
2025-09-30T01:34:54.9034586Z     return _ConnectionFairy._checkout(self)
2025-09-30T01:34:54.9035207Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9036444Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:1363: in _checkout
2025-09-30T01:34:54.9037570Z     with util.safe_reraise():
2025-09-30T01:34:54.9038021Z          ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9039319Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
2025-09-30T01:34:54.9040593Z     raise exc_value.with_traceback(exc_tb)
2025-09-30T01:34:54.9041729Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:1301: in _checkout
2025-09-30T01:34:54.9042931Z     result = pool._dialect._do_ping_w_event(
2025-09-30T01:34:54.9044260Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:720: in _do_ping_w_event
2025-09-30T01:34:54.9045594Z     return self.do_ping(dbapi_connection)
2025-09-30T01:34:54.9046195Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9047376Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:1163: in do_ping
2025-09-30T01:34:54.9048678Z     dbapi_connection.ping()
2025-09-30T01:34:54.9050032Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:813: in ping
2025-09-30T01:34:54.9051343Z     self._handle_exception(error)
2025-09-30T01:34:54.9052750Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:794: in _handle_exception
2025-09-30T01:34:54.9054333Z     raise error
2025-09-30T01:34:54.9055471Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:811: in ping
2025-09-30T01:34:54.9056744Z     _ = self.await_(self._async_ping())
2025-09-30T01:34:54.9057285Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9058582Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.9060705Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.9061765Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9063403Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.9064482Z     value = await result
2025-09-30T01:34:54.9064629Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.9065390Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:820: in _async_ping
2025-09-30T01:34:54.9065559Z     await tr.start()
2025-09-30T01:34:54.9066147Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/transaction.py:146: in start
2025-09-30T01:34:54.9066359Z     await self._connection.execute(query)
2025-09-30T01:34:54.9066939Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:349: in execute
2025-09-30T01:34:54.9067219Z     result = await self._protocol.query(query, timeout)
2025-09-30T01:34:54.9067349Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9067535Z asyncpg/protocol/protocol.pyx:375: in query
2025-09-30T01:34:54.9067679Z     ???
2025-09-30T01:34:54.9070729Z E   RuntimeError: Task <Task pending name='Task-28' coro=<TestCriticalUserJourneys.test_authentication_security() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_critical_workflows.py:146> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9071206Z ------------------------------ Captured log call -------------------------------
2025-09-30T01:34:54.9072347Z ERROR    sqlalchemy.pool.impl.AsyncAdaptedQueuePool:base.py:378 Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7ff8191c8b90>>
2025-09-30T01:34:54.9072633Z Traceback (most recent call last):
2025-09-30T01:34:54.9082889Z   File "/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
2025-09-30T01:34:54.9083155Z     self._dialect.do_terminate(connection)
2025-09-30T01:34:54.9083312Z     ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
2025-09-30T01:34:54.9084266Z   File "/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
2025-09-30T01:34:54.9084452Z     dbapi_connection.terminate()
2025-09-30T01:34:54.9084613Z     ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
2025-09-30T01:34:54.9085538Z   File "/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 907, in terminate
2025-09-30T01:34:54.9085890Z     self.await_(asyncio.shield(self._connection.close(timeout=2)))
2025-09-30T01:34:54.9086083Z     ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9086970Z   File "/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
2025-09-30T01:34:54.9087434Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.9087572Z            ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
2025-09-30T01:34:54.9088519Z   File "/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
2025-09-30T01:34:54.9088667Z     value = await result
2025-09-30T01:34:54.9088815Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.9089759Z   File "/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py", line 1504, in close
2025-09-30T01:34:54.9089949Z     await self._protocol.close(timeout)
2025-09-30T01:34:54.9090283Z   File "asyncpg/protocol/protocol.pyx", line 628, in close
2025-09-30T01:34:54.9092619Z RuntimeError: Task <Task pending name='Task-29' coro=<Connection.close() running at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:1504> cb=[shield.<locals>._inner_done_callback() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/tasks.py:958]> got Future <Future pending> attached to a different loop
2025-09-30T01:34:54.9092880Z ---------------------------- Captured log teardown -----------------------------
2025-09-30T01:34:54.9093168Z ERROR    asyncio:base_events.py:1879 Future exception was never retrieved
2025-09-30T01:34:54.9093628Z future: <Future finished exception=InternalClientError('got result for unknown protocol state 3')>
2025-09-30T01:34:54.9093833Z Traceback (most recent call last):
2025-09-30T01:34:54.9094561Z   File "asyncpg/protocol/protocol.pyx", line 903, in asyncpg.protocol.protocol.BaseProtocol._dispatch_result
2025-09-30T01:34:54.9095055Z asyncpg.exceptions._base.InternalClientError: got result for unknown protocol state 3
2025-09-30T01:34:54.9095483Z _____________ TestDatabaseConstraints.test_message_xor_constraint ______________
2025-09-30T01:34:54.9096187Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:876: in rollback
2025-09-30T01:34:54.9096406Z     self.await_(self._rollback_and_discard())
2025-09-30T01:34:54.9097110Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.9097744Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.9097908Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9098851Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.9099015Z     value = await result
2025-09-30T01:34:54.9099289Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.9100283Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:857: in _rollback_and_discard
2025-09-30T01:34:54.9100484Z     await self._transaction.rollback()
2025-09-30T01:34:54.9101160Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/transaction.py:227: in rollback
2025-09-30T01:34:54.9101327Z     await self.__rollback()
2025-09-30T01:34:54.9101904Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/transaction.py:206: in __rollback
2025-09-30T01:34:54.9102138Z     await self._connection.execute(query)
2025-09-30T01:34:54.9102744Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:349: in execute
2025-09-30T01:34:54.9102987Z     result = await self._protocol.query(query, timeout)
2025-09-30T01:34:54.9103162Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9103383Z asyncpg/protocol/protocol.pyx:360: in query
2025-09-30T01:34:54.9103538Z     ???
2025-09-30T01:34:54.9104082Z asyncpg/protocol/protocol.pyx:745: in asyncpg.protocol.protocol.BaseProtocol._check_state
2025-09-30T01:34:54.9104223Z     ???
2025-09-30T01:34:54.9104934Z E   asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress
2025-09-30T01:34:54.9104946Z 
2025-09-30T01:34:54.9105338Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.9106374Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1124: in _rollback_impl
2025-09-30T01:34:54.9106675Z     self.engine.dialect.do_rollback(self.connection)
2025-09-30T01:34:54.9107548Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:703: in do_rollback
2025-09-30T01:34:54.9107819Z     dbapi_connection.rollback()
2025-09-30T01:34:54.9108909Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:882: in rollback
2025-09-30T01:34:54.9109285Z     self._handle_exception(error)
2025-09-30T01:34:54.9110784Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.9111073Z     raise translated_error from error
2025-09-30T01:34:54.9113159Z E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
2025-09-30T01:34:54.9113174Z 
2025-09-30T01:34:54.9113728Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.9114354Z tests/e2e/test_database_constraints.py:30: in test_message_xor_constraint
2025-09-30T01:34:54.9114645Z     await async_db_session.commit()
2025-09-30T01:34:54.9115798Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1014: in commit
2025-09-30T01:34:54.9116145Z     await greenlet_spawn(self.sync_session.commit)
2025-09-30T01:34:54.9117448Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
2025-09-30T01:34:54.9117737Z     result = context.throw(*sys.exc_info())
2025-09-30T01:34:54.9117971Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9118993Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2032: in commit
2025-09-30T01:34:54.9119400Z     trans.commit(_to_root=True)
2025-09-30T01:34:54.9119649Z <string>:2: in commit
2025-09-30T01:34:54.9119860Z     ???
2025-09-30T01:34:54.9120919Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.9121356Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.9121579Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9122592Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1313: in commit
2025-09-30T01:34:54.9122965Z     self._prepare_impl()
2025-09-30T01:34:54.9123222Z <string>:2: in _prepare_impl
2025-09-30T01:34:54.9123429Z     ???
2025-09-30T01:34:54.9124475Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.9124740Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.9124958Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9126123Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1288: in _prepare_impl
2025-09-30T01:34:54.9126385Z     self.session.flush()
2025-09-30T01:34:54.9127392Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4345: in flush
2025-09-30T01:34:54.9127643Z     self._flush(objects)
2025-09-30T01:34:54.9128656Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4480: in _flush
2025-09-30T01:34:54.9128908Z     with util.safe_reraise():
2025-09-30T01:34:54.9129261Z          ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9130377Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:228: in __exit__
2025-09-30T01:34:54.9130669Z     raise value.with_traceback(traceback)
2025-09-30T01:34:54.9131699Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4481: in _flush
2025-09-30T01:34:54.9132047Z     transaction.rollback(_capture_exception=True)
2025-09-30T01:34:54.9132282Z <string>:2: in rollback
2025-09-30T01:34:54.9132499Z     ???
2025-09-30T01:34:54.9133504Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.9133758Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.9133995Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9135037Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1395: in rollback
2025-09-30T01:34:54.9135440Z     raise rollback_err[1].with_traceback(rollback_err[2])
2025-09-30T01:34:54.9136505Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1360: in rollback
2025-09-30T01:34:54.9136729Z     t[1].rollback()
2025-09-30T01:34:54.9137762Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2607: in rollback
2025-09-30T01:34:54.9138004Z     self._do_rollback()
2025-09-30T01:34:54.9139435Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2726: in _do_rollback
2025-09-30T01:34:54.9139726Z     self._close_impl(try_deactivate=True)
2025-09-30T01:34:54.9140839Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2709: in _close_impl
2025-09-30T01:34:54.9141125Z     self._connection_rollback_impl()
2025-09-30T01:34:54.9142431Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2701: in _connection_rollback_impl
2025-09-30T01:34:54.9142649Z     self.connection._rollback_impl()
2025-09-30T01:34:54.9143413Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1126: in _rollback_impl
2025-09-30T01:34:54.9143723Z     self._handle_dbapi_exception(e, None, None, None, None)
2025-09-30T01:34:54.9144673Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2351: in _handle_dbapi_exception
2025-09-30T01:34:54.9145053Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-09-30T01:34:54.9145902Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1124: in _rollback_impl
2025-09-30T01:34:54.9146205Z     self.engine.dialect.do_rollback(self.connection)
2025-09-30T01:34:54.9147226Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:703: in do_rollback
2025-09-30T01:34:54.9147442Z     dbapi_connection.rollback()
2025-09-30T01:34:54.9148520Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:882: in rollback
2025-09-30T01:34:54.9148729Z     self._handle_exception(error)
2025-09-30T01:34:54.9149947Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.9150176Z     raise translated_error from error
2025-09-30T01:34:54.9151841Z E   sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
2025-09-30T01:34:54.9152248Z E   (Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-09-30T01:34:54.9152765Z _____________ TestDatabaseConstraints.test_foreign_key_constraints _____________
2025-09-30T01:34:54.9153252Z tests/e2e/test_database_constraints.py:112: in test_foreign_key_constraints
2025-09-30T01:34:54.9153468Z     await async_db_session.commit()
2025-09-30T01:34:54.9154375Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1014: in commit
2025-09-30T01:34:54.9154633Z     await greenlet_spawn(self.sync_session.commit)
2025-09-30T01:34:54.9155613Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
2025-09-30T01:34:54.9155834Z     result = context.throw(*sys.exc_info())
2025-09-30T01:34:54.9156009Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9156812Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2032: in commit
2025-09-30T01:34:54.9157011Z     trans.commit(_to_root=True)
2025-09-30T01:34:54.9157195Z <string>:2: in commit
2025-09-30T01:34:54.9157374Z     ???
2025-09-30T01:34:54.9158197Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.9158394Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.9158581Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9159505Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1320: in commit
2025-09-30T01:34:54.9159693Z     trans.commit()
2025-09-30T01:34:54.9160473Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2628: in commit
2025-09-30T01:34:54.9160655Z     self._do_commit()
2025-09-30T01:34:54.9161481Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2733: in _do_commit
2025-09-30T01:34:54.9161702Z     self._connection_commit_impl()
2025-09-30T01:34:54.9162775Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2704: in _connection_commit_impl
2025-09-30T01:34:54.9163003Z     self.connection._commit_impl()
2025-09-30T01:34:54.9163918Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1143: in _commit_impl
2025-09-30T01:34:54.9164244Z     self._handle_dbapi_exception(e, None, None, None, None)
2025-09-30T01:34:54.9165226Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2354: in _handle_dbapi_exception
2025-09-30T01:34:54.9165495Z     raise exc_info[1].with_traceback(exc_info[2])
2025-09-30T01:34:54.9166391Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1141: in _commit_impl
2025-09-30T01:34:54.9166680Z     self.engine.dialect.do_commit(self.connection)
2025-09-30T01:34:54.9167512Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:706: in do_commit
2025-09-30T01:34:54.9167623Z     dbapi_connection.commit()
2025-09-30T01:34:54.9168339Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:893: in commit
2025-09-30T01:34:54.9168471Z     self._handle_exception(error)
2025-09-30T01:34:54.9169120Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:794: in _handle_exception
2025-09-30T01:34:54.9169461Z     raise error
2025-09-30T01:34:54.9170001Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:887: in commit
2025-09-30T01:34:54.9170139Z     self.await_(self._commit_and_discard())
2025-09-30T01:34:54.9170675Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.9171066Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.9171169Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9171749Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.9171877Z     value = await result
2025-09-30T01:34:54.9171977Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.9172595Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:866: in _commit_and_discard
2025-09-30T01:34:54.9172726Z     await self._transaction.commit()
2025-09-30T01:34:54.9173140Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/transaction.py:219: in commit
2025-09-30T01:34:54.9173248Z     await self.__commit()
2025-09-30T01:34:54.9173670Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/transaction.py:187: in __commit
2025-09-30T01:34:54.9173811Z     await self._connection.execute(query)
2025-09-30T01:34:54.9174283Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:349: in execute
2025-09-30T01:34:54.9174464Z     result = await self._protocol.query(query, timeout)
2025-09-30T01:34:54.9174589Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9174748Z asyncpg/protocol/protocol.pyx:375: in query
2025-09-30T01:34:54.9174844Z     ???
2025-09-30T01:34:54.9176739Z E   RuntimeError: Task <Task pending name='Task-53' coro=<TestDatabaseConstraints.test_foreign_key_constraints() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_database_constraints.py:112> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9177072Z ______ TestDatabaseConstraints.test_conversation_participant_constraints _______
2025-09-30T01:34:54.9177610Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:876: in rollback
2025-09-30T01:34:54.9177770Z     self.await_(self._rollback_and_discard())
2025-09-30T01:34:54.9178284Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.9178647Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.9178767Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9179458Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.9179576Z     value = await result
2025-09-30T01:34:54.9179686Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.9180334Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:857: in _rollback_and_discard
2025-09-30T01:34:54.9180474Z     await self._transaction.rollback()
2025-09-30T01:34:54.9180896Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/transaction.py:227: in rollback
2025-09-30T01:34:54.9181153Z     await self.__rollback()
2025-09-30T01:34:54.9181595Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/transaction.py:206: in __rollback
2025-09-30T01:34:54.9181741Z     await self._connection.execute(query)
2025-09-30T01:34:54.9182255Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:349: in execute
2025-09-30T01:34:54.9182423Z     result = await self._protocol.query(query, timeout)
2025-09-30T01:34:54.9182546Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9182679Z asyncpg/protocol/protocol.pyx:360: in query
2025-09-30T01:34:54.9182771Z     ???
2025-09-30T01:34:54.9183161Z asyncpg/protocol/protocol.pyx:745: in asyncpg.protocol.protocol.BaseProtocol._check_state
2025-09-30T01:34:54.9183249Z     ???
2025-09-30T01:34:54.9183660Z E   asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress
2025-09-30T01:34:54.9183671Z 
2025-09-30T01:34:54.9183932Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.9184433Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1124: in _rollback_impl
2025-09-30T01:34:54.9184613Z     self.engine.dialect.do_rollback(self.connection)
2025-09-30T01:34:54.9185115Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:703: in do_rollback
2025-09-30T01:34:54.9185248Z     dbapi_connection.rollback()
2025-09-30T01:34:54.9185792Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:882: in rollback
2025-09-30T01:34:54.9185923Z     self._handle_exception(error)
2025-09-30T01:34:54.9186508Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.9186653Z     raise translated_error from error
2025-09-30T01:34:54.9187487Z E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
2025-09-30T01:34:54.9187506Z 
2025-09-30T01:34:54.9187758Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.9188109Z tests/e2e/test_database_constraints.py:149: in test_conversation_participant_constraints
2025-09-30T01:34:54.9188246Z     await async_db_session.commit()
2025-09-30T01:34:54.9188752Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1014: in commit
2025-09-30T01:34:54.9188933Z     await greenlet_spawn(self.sync_session.commit)
2025-09-30T01:34:54.9189625Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
2025-09-30T01:34:54.9189774Z     result = context.throw(*sys.exc_info())
2025-09-30T01:34:54.9189891Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9190340Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2032: in commit
2025-09-30T01:34:54.9190470Z     trans.commit(_to_root=True)
2025-09-30T01:34:54.9190589Z <string>:2: in commit
2025-09-30T01:34:54.9190685Z     ???
2025-09-30T01:34:54.9191128Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.9191256Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.9191354Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9191805Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1313: in commit
2025-09-30T01:34:54.9191926Z     self._prepare_impl()
2025-09-30T01:34:54.9192048Z <string>:2: in _prepare_impl
2025-09-30T01:34:54.9192137Z     ???
2025-09-30T01:34:54.9192587Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.9192707Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.9192966Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9193456Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1288: in _prepare_impl
2025-09-30T01:34:54.9193657Z     self.session.flush()
2025-09-30T01:34:54.9194095Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4345: in flush
2025-09-30T01:34:54.9194212Z     self._flush(objects)
2025-09-30T01:34:54.9194664Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4480: in _flush
2025-09-30T01:34:54.9194786Z     with util.safe_reraise():
2025-09-30T01:34:54.9194891Z          ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9195369Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:228: in __exit__
2025-09-30T01:34:54.9195507Z     raise value.with_traceback(traceback)
2025-09-30T01:34:54.9195953Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4481: in _flush
2025-09-30T01:34:54.9196118Z     transaction.rollback(_capture_exception=True)
2025-09-30T01:34:54.9196214Z <string>:2: in rollback
2025-09-30T01:34:54.9196304Z     ???
2025-09-30T01:34:54.9196747Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.9196861Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.9196976Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9197378Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1395: in rollback
2025-09-30T01:34:54.9197547Z     raise rollback_err[1].with_traceback(rollback_err[2])
2025-09-30T01:34:54.9197965Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1360: in rollback
2025-09-30T01:34:54.9198059Z     t[1].rollback()
2025-09-30T01:34:54.9198503Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2607: in rollback
2025-09-30T01:34:54.9198635Z     self._do_rollback()
2025-09-30T01:34:54.9199123Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2726: in _do_rollback
2025-09-30T01:34:54.9199407Z     self._close_impl(try_deactivate=True)
2025-09-30T01:34:54.9199872Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2709: in _close_impl
2025-09-30T01:34:54.9199998Z     self._connection_rollback_impl()
2025-09-30T01:34:54.9200546Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2701: in _connection_rollback_impl
2025-09-30T01:34:54.9200684Z     self.connection._rollback_impl()
2025-09-30T01:34:54.9201168Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1126: in _rollback_impl
2025-09-30T01:34:54.9201353Z     self._handle_dbapi_exception(e, None, None, None, None)
2025-09-30T01:34:54.9201912Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2351: in _handle_dbapi_exception
2025-09-30T01:34:54.9202149Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-09-30T01:34:54.9202654Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1124: in _rollback_impl
2025-09-30T01:34:54.9202838Z     self.engine.dialect.do_rollback(self.connection)
2025-09-30T01:34:54.9203309Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:703: in do_rollback
2025-09-30T01:34:54.9203452Z     dbapi_connection.rollback()
2025-09-30T01:34:54.9204025Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:882: in rollback
2025-09-30T01:34:54.9204154Z     self._handle_exception(error)
2025-09-30T01:34:54.9204738Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.9205010Z     raise translated_error from error
2025-09-30T01:34:54.9205929Z E   sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
2025-09-30T01:34:54.9206271Z E   (Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-09-30T01:34:54.9206534Z ______________ TestDatabaseConstraints.test_nullable_constraints _______________
2025-09-30T01:34:54.9207066Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:876: in rollback
2025-09-30T01:34:54.9207227Z     self.await_(self._rollback_and_discard())
2025-09-30T01:34:54.9207696Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.9208075Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.9208195Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9208728Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.9208861Z     value = await result
2025-09-30T01:34:54.9208976Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.9209725Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:857: in _rollback_and_discard
2025-09-30T01:34:54.9209882Z     await self._transaction.rollback()
2025-09-30T01:34:54.9210313Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/transaction.py:227: in rollback
2025-09-30T01:34:54.9210423Z     await self.__rollback()
2025-09-30T01:34:54.9210910Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/transaction.py:206: in __rollback
2025-09-30T01:34:54.9211042Z     await self._connection.execute(query)
2025-09-30T01:34:54.9211431Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:349: in execute
2025-09-30T01:34:54.9211618Z     result = await self._protocol.query(query, timeout)
2025-09-30T01:34:54.9211736Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9211891Z asyncpg/protocol/protocol.pyx:360: in query
2025-09-30T01:34:54.9211994Z     ???
2025-09-30T01:34:54.9212359Z asyncpg/protocol/protocol.pyx:745: in asyncpg.protocol.protocol.BaseProtocol._check_state
2025-09-30T01:34:54.9212465Z     ???
2025-09-30T01:34:54.9212859Z E   asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress
2025-09-30T01:34:54.9212868Z 
2025-09-30T01:34:54.9213123Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.9213644Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1124: in _rollback_impl
2025-09-30T01:34:54.9213854Z     self.engine.dialect.do_rollback(self.connection)
2025-09-30T01:34:54.9214382Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:703: in do_rollback
2025-09-30T01:34:54.9214508Z     dbapi_connection.rollback()
2025-09-30T01:34:54.9215060Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:882: in rollback
2025-09-30T01:34:54.9215185Z     self._handle_exception(error)
2025-09-30T01:34:54.9215800Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.9215932Z     raise translated_error from error
2025-09-30T01:34:54.9216804Z E   sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
2025-09-30T01:34:54.9216815Z 
2025-09-30T01:34:54.9217083Z The above exception was the direct cause of the following exception:
2025-09-30T01:34:54.9217354Z tests/e2e/test_database_constraints.py:193: in test_nullable_constraints
2025-09-30T01:34:54.9217686Z     await async_db_session.commit()
2025-09-30T01:34:54.9218184Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:1014: in commit
2025-09-30T01:34:54.9218472Z     await greenlet_spawn(self.sync_session.commit)
2025-09-30T01:34:54.9219021Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
2025-09-30T01:34:54.9219288Z     result = context.throw(*sys.exc_info())
2025-09-30T01:34:54.9219408Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9219844Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2032: in commit
2025-09-30T01:34:54.9219976Z     trans.commit(_to_root=True)
2025-09-30T01:34:54.9220075Z <string>:2: in commit
2025-09-30T01:34:54.9220166Z     ???
2025-09-30T01:34:54.9220624Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.9220757Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.9220859Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9221280Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1313: in commit
2025-09-30T01:34:54.9221400Z     self._prepare_impl()
2025-09-30T01:34:54.9221520Z <string>:2: in _prepare_impl
2025-09-30T01:34:54.9221613Z     ???
2025-09-30T01:34:54.9222055Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.9222176Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.9222280Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9222765Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1288: in _prepare_impl
2025-09-30T01:34:54.9222876Z     self.session.flush()
2025-09-30T01:34:54.9223339Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4345: in flush
2025-09-30T01:34:54.9223459Z     self._flush(objects)
2025-09-30T01:34:54.9223909Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4480: in _flush
2025-09-30T01:34:54.9224044Z     with util.safe_reraise():
2025-09-30T01:34:54.9224148Z          ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9224636Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:228: in __exit__
2025-09-30T01:34:54.9224777Z     raise value.with_traceback(traceback)
2025-09-30T01:34:54.9225226Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4481: in _flush
2025-09-30T01:34:54.9225393Z     transaction.rollback(_capture_exception=True)
2025-09-30T01:34:54.9225511Z <string>:2: in rollback
2025-09-30T01:34:54.9225595Z     ???
2025-09-30T01:34:54.9226106Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.9226239Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.9226335Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9226793Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1395: in rollback
2025-09-30T01:34:54.9226986Z     raise rollback_err[1].with_traceback(rollback_err[2])
2025-09-30T01:34:54.9227439Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1360: in rollback
2025-09-30T01:34:54.9227528Z     t[1].rollback()
2025-09-30T01:34:54.9227993Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2607: in rollback
2025-09-30T01:34:54.9228097Z     self._do_rollback()
2025-09-30T01:34:54.9228597Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2726: in _do_rollback
2025-09-30T01:34:54.9228749Z     self._close_impl(try_deactivate=True)
2025-09-30T01:34:54.9229328Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2709: in _close_impl
2025-09-30T01:34:54.9229604Z     self._connection_rollback_impl()
2025-09-30T01:34:54.9230157Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2701: in _connection_rollback_impl
2025-09-30T01:34:54.9230372Z     self.connection._rollback_impl()
2025-09-30T01:34:54.9230866Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1126: in _rollback_impl
2025-09-30T01:34:54.9231086Z     self._handle_dbapi_exception(e, None, None, None, None)
2025-09-30T01:34:54.9231656Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2351: in _handle_dbapi_exception
2025-09-30T01:34:54.9231879Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-09-30T01:34:54.9232416Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1124: in _rollback_impl
2025-09-30T01:34:54.9232608Z     self.engine.dialect.do_rollback(self.connection)
2025-09-30T01:34:54.9233128Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:703: in do_rollback
2025-09-30T01:34:54.9233261Z     dbapi_connection.rollback()
2025-09-30T01:34:54.9233842Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:882: in rollback
2025-09-30T01:34:54.9233990Z     self._handle_exception(error)
2025-09-30T01:34:54.9234653Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:792: in _handle_exception
2025-09-30T01:34:54.9234795Z     raise translated_error from error
2025-09-30T01:34:54.9235810Z E   sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
2025-09-30T01:34:54.9236049Z E   (Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-09-30T01:34:54.9236351Z _____________ TestDatabaseConstraints.test_database_indexes_exist ______________
2025-09-30T01:34:54.9236641Z tests/e2e/test_database_constraints.py:280: in test_database_indexes_exist
2025-09-30T01:34:54.9236822Z     result = await async_db_session.execute(text(sql))
2025-09-30T01:34:54.9236940Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9237416Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:463: in execute
2025-09-30T01:34:54.9237540Z     result = await greenlet_spawn(
2025-09-30T01:34:54.9238116Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
2025-09-30T01:34:54.9238275Z     result = context.throw(*sys.exc_info())
2025-09-30T01:34:54.9238407Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9238833Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-09-30T01:34:54.9238992Z     return self._execute_internal(
2025-09-30T01:34:54.9239638Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2241: in _execute_internal
2025-09-30T01:34:54.9239785Z     conn = self._connection_for_bind(bind)
2025-09-30T01:34:54.9239917Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9240481Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2110: in _connection_for_bind
2025-09-30T01:34:54.9240715Z     return trans._connection_for_bind(engine, execution_options)
2025-09-30T01:34:54.9240871Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9241000Z <string>:2: in _connection_for_bind
2025-09-30T01:34:54.9241104Z     ???
2025-09-30T01:34:54.9241576Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
2025-09-30T01:34:54.9241849Z     ret_value = fn(self, *arg, **kw)
2025-09-30T01:34:54.9241944Z                 ^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9242477Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1189: in _connection_for_bind
2025-09-30T01:34:54.9242696Z     conn = bind.connect()
2025-09-30T01:34:54.9242808Z            ^^^^^^^^^^^^^^
2025-09-30T01:34:54.9243284Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:3273: in connect
2025-09-30T01:34:54.9243419Z     return self._connection_cls(self)
2025-09-30T01:34:54.9243526Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9244019Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:145: in __init__
2025-09-30T01:34:54.9244198Z     self._dbapi_connection = engine.raw_connection()
2025-09-30T01:34:54.9244325Z                              ^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9244832Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:3297: in raw_connection
2025-09-30T01:34:54.9244971Z     return self.pool.connect()
2025-09-30T01:34:54.9245090Z            ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9245526Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:449: in connect
2025-09-30T01:34:54.9245676Z     return _ConnectionFairy._checkout(self)
2025-09-30T01:34:54.9245791Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9246244Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:1363: in _checkout
2025-09-30T01:34:54.9246364Z     with util.safe_reraise():
2025-09-30T01:34:54.9246479Z          ^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9246976Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
2025-09-30T01:34:54.9247113Z     raise exc_value.with_traceback(exc_tb)
2025-09-30T01:34:54.9247562Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py:1301: in _checkout
2025-09-30T01:34:54.9247705Z     result = pool._dialect._do_ping_w_event(
2025-09-30T01:34:54.9248228Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:720: in _do_ping_w_event
2025-09-30T01:34:54.9248376Z     return self.do_ping(dbapi_connection)
2025-09-30T01:34:54.9248488Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9249054Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:1163: in do_ping
2025-09-30T01:34:54.9249320Z     dbapi_connection.ping()
2025-09-30T01:34:54.9249873Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:813: in ping
2025-09-30T01:34:54.9250005Z     self._handle_exception(error)
2025-09-30T01:34:54.9250638Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:794: in _handle_exception
2025-09-30T01:34:54.9250741Z     raise error
2025-09-30T01:34:54.9251244Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:811: in ping
2025-09-30T01:34:54.9251385Z     _ = self.await_(self._async_ping())
2025-09-30T01:34:54.9251489Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9251990Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.9252392Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.9252497Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9253085Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.9253210Z     value = await result
2025-09-30T01:34:54.9253321Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.9253959Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:820: in _async_ping
2025-09-30T01:34:54.9254243Z     await tr.start()
2025-09-30T01:34:54.9254721Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/transaction.py:146: in start
2025-09-30T01:34:54.9254964Z     await self._connection.execute(query)
2025-09-30T01:34:54.9255403Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:349: in execute
2025-09-30T01:34:54.9255583Z     result = await self._protocol.query(query, timeout)
2025-09-30T01:34:54.9255725Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9255879Z asyncpg/protocol/protocol.pyx:375: in query
2025-09-30T01:34:54.9255965Z     ???
2025-09-30T01:34:54.9257967Z E   RuntimeError: Task <Task pending name='Task-87' coro=<TestDatabaseConstraints.test_database_indexes_exist() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_database_constraints.py:280> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9258242Z ------------------------------ Captured log call -------------------------------
2025-09-30T01:34:54.9259277Z ERROR    sqlalchemy.pool.impl.AsyncAdaptedQueuePool:base.py:378 Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7ff8157cd130>>
2025-09-30T01:34:54.9259439Z Traceback (most recent call last):
2025-09-30T01:34:54.9260229Z   File "/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
2025-09-30T01:34:54.9260394Z     self._dialect.do_terminate(connection)
2025-09-30T01:34:54.9260511Z     ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
2025-09-30T01:34:54.9261176Z   File "/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1130, in do_terminate
2025-09-30T01:34:54.9261340Z     dbapi_connection.terminate()
2025-09-30T01:34:54.9261443Z     ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
2025-09-30T01:34:54.9262053Z   File "/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 907, in terminate
2025-09-30T01:34:54.9262294Z     self.await_(asyncio.shield(self._connection.close(timeout=2)))
2025-09-30T01:34:54.9262425Z     ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9263008Z   File "/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
2025-09-30T01:34:54.9263380Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.9263492Z            ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
2025-09-30T01:34:54.9264113Z   File "/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
2025-09-30T01:34:54.9264238Z     value = await result
2025-09-30T01:34:54.9264347Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.9264894Z   File "/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py", line 1504, in close
2025-09-30T01:34:54.9265052Z     await self._protocol.close(timeout)
2025-09-30T01:34:54.9265324Z   File "asyncpg/protocol/protocol.pyx", line 628, in close
2025-09-30T01:34:54.9266918Z RuntimeError: Task <Task pending name='Task-88' coro=<Connection.close() running at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:1504> cb=[shield.<locals>._inner_done_callback() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/tasks.py:958]> got Future <Future pending> attached to a different loop
2025-09-30T01:34:54.9267182Z ---------------------------- Captured log teardown -----------------------------
2025-09-30T01:34:54.9267461Z ERROR    asyncio:base_events.py:1879 Future exception was never retrieved
2025-09-30T01:34:54.9268049Z future: <Future finished exception=InternalClientError('got result for unknown protocol state 3')>
2025-09-30T01:34:54.9268196Z Traceback (most recent call last):
2025-09-30T01:34:54.9268871Z   File "asyncpg/protocol/protocol.pyx", line 903, in asyncpg.protocol.protocol.BaseProtocol._dispatch_result
2025-09-30T01:34:54.9269401Z asyncpg.exceptions._base.InternalClientError: got result for unknown protocol state 3
2025-09-30T01:34:54.9269691Z _________________ TestIntegrationAPI.test_room_count_endpoint __________________
2025-09-30T01:34:54.9269921Z tests/e2e/test_integration_api.py:83: in test_room_count_endpoint
2025-09-30T01:34:54.9270139Z     response = await authenticated_client.get("/api/v1/rooms/count")
2025-09-30T01:34:54.9270270Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9270669Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1768: in get
2025-09-30T01:34:54.9270801Z     return await self.request(
2025-09-30T01:34:54.9271195Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1540: in request
2025-09-30T01:34:54.9271486Z     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-09-30T01:34:54.9271614Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9272022Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1629: in send
2025-09-30T01:34:54.9272183Z     response = await self._send_handling_auth(
2025-09-30T01:34:54.9272651Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
2025-09-30T01:34:54.9272808Z     response = await self._send_handling_redirects(
2025-09-30T01:34:54.9273319Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
2025-09-30T01:34:54.9273513Z     response = await self._send_single_request(request)
2025-09-30T01:34:54.9273637Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9274097Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
2025-09-30T01:34:54.9274306Z     response = await transport.handle_async_request(request)
2025-09-30T01:34:54.9274434Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9274939Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
2025-09-30T01:34:54.9275094Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.9275586Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/applications.py:1054: in __call__
2025-09-30T01:34:54.9275748Z     await super().__call__(scope, receive, send)
2025-09-30T01:34:54.9276232Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/applications.py:112: in __call__
2025-09-30T01:34:54.9276423Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.9276939Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:187: in __call__
2025-09-30T01:34:54.9277056Z     raise exc
2025-09-30T01:34:54.9277550Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:165: in __call__
2025-09-30T01:34:54.9277683Z     await self.app(scope, receive, _send)
2025-09-30T01:34:54.9278207Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/exceptions.py:62: in __call__
2025-09-30T01:34:54.9278488Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-09-30T01:34:54.9279057Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.9279300Z     raise exc
2025-09-30T01:34:54.9279753Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.9280018Z     await app(scope, receive, sender)
2025-09-30T01:34:54.9280410Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:714: in __call__
2025-09-30T01:34:54.9280682Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.9281103Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:734: in app
2025-09-30T01:34:54.9281243Z     await route.handle(scope, receive, send)
2025-09-30T01:34:54.9281613Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:288: in handle
2025-09-30T01:34:54.9281740Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.9282096Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:76: in app
2025-09-30T01:34:54.9282349Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-09-30T01:34:54.9282851Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.9282950Z     raise exc
2025-09-30T01:34:54.9283400Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.9283531Z     await app(scope, receive, sender)
2025-09-30T01:34:54.9283915Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:73: in app
2025-09-30T01:34:54.9284035Z     response = await f(request)
2025-09-30T01:34:54.9284139Z                ^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9284521Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/routing.py:301: in app
2025-09-30T01:34:54.9284680Z     raw_response = await run_endpoint_function(
2025-09-30T01:34:54.9285197Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/routing.py:212: in run_endpoint_function
2025-09-30T01:34:54.9285337Z     return await dependant.call(**values)
2025-09-30T01:34:54.9285448Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9285681Z app/api/v1/endpoints/room_router.py:107: in get_room_count
2025-09-30T01:34:54.9285835Z     return await room_service.get_room_count()
2025-09-30T01:34:54.9285952Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9286136Z app/services/room_service.py:142: in get_room_count
2025-09-30T01:34:54.9286337Z     active_rooms = await self.room_repo.get_active_rooms()
2025-09-30T01:34:54.9286448Z                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9286679Z app/repositories/room_repository.py:64: in get_active_rooms
2025-09-30T01:34:54.9286813Z     result = await self.db.execute(query)
2025-09-30T01:34:54.9286919Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9287426Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:463: in execute
2025-09-30T01:34:54.9287559Z     result = await greenlet_spawn(
2025-09-30T01:34:54.9288128Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
2025-09-30T01:34:54.9288275Z     result = context.throw(*sys.exc_info())
2025-09-30T01:34:54.9288383Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9288778Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-09-30T01:34:54.9288904Z     return self._execute_internal(
2025-09-30T01:34:54.9289536Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-09-30T01:34:54.9289769Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-09-30T01:34:54.9290320Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-09-30T01:34:54.9290441Z     result = conn.execute(
2025-09-30T01:34:54.9290885Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1415: in execute
2025-09-30T01:34:54.9291159Z     return meth(
2025-09-30T01:34:54.9291724Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:523: in _execute_on_connection
2025-09-30T01:34:54.9291982Z     return connection._execute_clauseelement(
2025-09-30T01:34:54.9292561Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1637: in _execute_clauseelement
2025-09-30T01:34:54.9292683Z     ret = self._execute_context(
2025-09-30T01:34:54.9293197Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1842: in _execute_context
2025-09-30T01:34:54.9293328Z     return self._exec_single_context(
2025-09-30T01:34:54.9293853Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1982: in _exec_single_context
2025-09-30T01:34:54.9293991Z     self._handle_dbapi_exception(
2025-09-30T01:34:54.9294560Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2354: in _handle_dbapi_exception
2025-09-30T01:34:54.9294707Z     raise exc_info[1].with_traceback(exc_info[2])
2025-09-30T01:34:54.9295266Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1963: in _exec_single_context
2025-09-30T01:34:54.9295404Z     self.dialect.do_execute(
2025-09-30T01:34:54.9295888Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:943: in do_execute
2025-09-30T01:34:54.9296028Z     cursor.execute(statement, parameters)
2025-09-30T01:34:54.9296574Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
2025-09-30T01:34:54.9296694Z     self._adapt_connection.await_(
2025-09-30T01:34:54.9297217Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.9297619Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.9297736Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9298321Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.9298447Z     value = await result
2025-09-30T01:34:54.9298548Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.9299382Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
2025-09-30T01:34:54.9299516Z     self._handle_exception(error)
2025-09-30T01:34:54.9300101Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
2025-09-30T01:34:54.9300286Z     self._adapt_connection._handle_exception(error)
2025-09-30T01:34:54.9300878Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:794: in _handle_exception
2025-09-30T01:34:54.9300979Z     raise error
2025-09-30T01:34:54.9301582Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:521: in _prepare_and_execute
2025-09-30T01:34:54.9301817Z     prepared_stmt, attributes = await adapt_connection._prepare(
2025-09-30T01:34:54.9302368Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:768: in _prepare
2025-09-30T01:34:54.9302536Z     prepared_stmt = await self._connection.prepare(
2025-09-30T01:34:54.9302944Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:635: in prepare
2025-09-30T01:34:54.9303071Z     return await self._prepare(
2025-09-30T01:34:54.9303502Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:653: in _prepare
2025-09-30T01:34:54.9303623Z     stmt = await self._get_statement(
2025-09-30T01:34:54.9304281Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:432: in _get_statement
2025-09-30T01:34:54.9304430Z     statement = await self._protocol.prepare(
2025-09-30T01:34:54.9304600Z asyncpg/protocol/protocol.pyx:165: in prepare
2025-09-30T01:34:54.9304790Z     ???
2025-09-30T01:34:54.9306700Z E   RuntimeError: Task <Task pending name='Task-106' coro=<TestIntegrationAPI.test_room_count_endpoint() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_integration_api.py:83> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9306937Z ---------------------------- Captured stdout setup -----------------------------
2025-09-30T01:34:54.9307395Z ✅ Created integration test user with ID: 1
2025-09-30T01:34:54.9307671Z ________________ TestIntegrationAPI.test_get_all_rooms_endpoint ________________
2025-09-30T01:34:54.9307937Z tests/e2e/test_integration_api.py:93: in test_get_all_rooms_endpoint
2025-09-30T01:34:54.9308175Z     response = await authenticated_client.get("/api/v1/rooms/")
2025-09-30T01:34:54.9308305Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9308709Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1768: in get
2025-09-30T01:34:54.9308841Z     return await self.request(
2025-09-30T01:34:54.9309370Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1540: in request
2025-09-30T01:34:54.9309660Z     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-09-30T01:34:54.9309806Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9310199Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1629: in send
2025-09-30T01:34:54.9310373Z     response = await self._send_handling_auth(
2025-09-30T01:34:54.9310823Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
2025-09-30T01:34:54.9310980Z     response = await self._send_handling_redirects(
2025-09-30T01:34:54.9311468Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
2025-09-30T01:34:54.9311631Z     response = await self._send_single_request(request)
2025-09-30T01:34:54.9311743Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9312203Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
2025-09-30T01:34:54.9312394Z     response = await transport.handle_async_request(request)
2025-09-30T01:34:54.9312511Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9313041Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
2025-09-30T01:34:54.9313182Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.9313686Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/applications.py:1054: in __call__
2025-09-30T01:34:54.9313848Z     await super().__call__(scope, receive, send)
2025-09-30T01:34:54.9314305Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/applications.py:112: in __call__
2025-09-30T01:34:54.9314493Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.9314995Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:187: in __call__
2025-09-30T01:34:54.9315096Z     raise exc
2025-09-30T01:34:54.9315587Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:165: in __call__
2025-09-30T01:34:54.9315726Z     await self.app(scope, receive, _send)
2025-09-30T01:34:54.9316211Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/exceptions.py:62: in __call__
2025-09-30T01:34:54.9316707Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-09-30T01:34:54.9317218Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.9317407Z     raise exc
2025-09-30T01:34:54.9317914Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.9318039Z     await app(scope, receive, sender)
2025-09-30T01:34:54.9318469Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:714: in __call__
2025-09-30T01:34:54.9318639Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.9319028Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:734: in app
2025-09-30T01:34:54.9319296Z     await route.handle(scope, receive, send)
2025-09-30T01:34:54.9319734Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:288: in handle
2025-09-30T01:34:54.9319870Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.9320271Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:76: in app
2025-09-30T01:34:54.9320551Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-09-30T01:34:54.9321038Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.9321132Z     raise exc
2025-09-30T01:34:54.9321635Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.9321761Z     await app(scope, receive, sender)
2025-09-30T01:34:54.9322141Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:73: in app
2025-09-30T01:34:54.9322261Z     response = await f(request)
2025-09-30T01:34:54.9322375Z                ^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9322759Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/routing.py:301: in app
2025-09-30T01:34:54.9322918Z     raw_response = await run_endpoint_function(
2025-09-30T01:34:54.9323372Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/routing.py:212: in run_endpoint_function
2025-09-30T01:34:54.9323505Z     return await dependant.call(**values)
2025-09-30T01:34:54.9323607Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9323802Z app/api/v1/endpoints/room_router.py:32: in get_all_rooms
2025-09-30T01:34:54.9323942Z     return await room_service.get_all_rooms()
2025-09-30T01:34:54.9324041Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9324198Z app/services/room_service.py:41: in get_all_rooms
2025-09-30T01:34:54.9324356Z     return await self.room_repo.get_active_rooms()
2025-09-30T01:34:54.9324474Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9324711Z app/repositories/room_repository.py:64: in get_active_rooms
2025-09-30T01:34:54.9324849Z     result = await self.db.execute(query)
2025-09-30T01:34:54.9324951Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9325453Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:463: in execute
2025-09-30T01:34:54.9325579Z     result = await greenlet_spawn(
2025-09-30T01:34:54.9326176Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
2025-09-30T01:34:54.9326311Z     result = context.throw(*sys.exc_info())
2025-09-30T01:34:54.9326437Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9326884Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-09-30T01:34:54.9327007Z     return self._execute_internal(
2025-09-30T01:34:54.9327518Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-09-30T01:34:54.9327884Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-09-30T01:34:54.9328436Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-09-30T01:34:54.9328659Z     result = conn.execute(
2025-09-30T01:34:54.9329120Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1415: in execute
2025-09-30T01:34:54.9329343Z     return meth(
2025-09-30T01:34:54.9329882Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:523: in _execute_on_connection
2025-09-30T01:34:54.9330028Z     return connection._execute_clauseelement(
2025-09-30T01:34:54.9330591Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1637: in _execute_clauseelement
2025-09-30T01:34:54.9330725Z     ret = self._execute_context(
2025-09-30T01:34:54.9331206Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1842: in _execute_context
2025-09-30T01:34:54.9331334Z     return self._exec_single_context(
2025-09-30T01:34:54.9331857Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1982: in _exec_single_context
2025-09-30T01:34:54.9331983Z     self._handle_dbapi_exception(
2025-09-30T01:34:54.9332513Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2354: in _handle_dbapi_exception
2025-09-30T01:34:54.9332677Z     raise exc_info[1].with_traceback(exc_info[2])
2025-09-30T01:34:54.9333201Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1963: in _exec_single_context
2025-09-30T01:34:54.9333310Z     self.dialect.do_execute(
2025-09-30T01:34:54.9333783Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:943: in do_execute
2025-09-30T01:34:54.9333933Z     cursor.execute(statement, parameters)
2025-09-30T01:34:54.9334445Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
2025-09-30T01:34:54.9334578Z     self._adapt_connection.await_(
2025-09-30T01:34:54.9335071Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.9335465Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.9335576Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9336142Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.9336260Z     value = await result
2025-09-30T01:34:54.9336361Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.9336987Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
2025-09-30T01:34:54.9337130Z     self._handle_exception(error)
2025-09-30T01:34:54.9337737Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
2025-09-30T01:34:54.9337915Z     self._adapt_connection._handle_exception(error)
2025-09-30T01:34:54.9338500Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:794: in _handle_exception
2025-09-30T01:34:54.9338599Z     raise error
2025-09-30T01:34:54.9339546Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:521: in _prepare_and_execute
2025-09-30T01:34:54.9339799Z     prepared_stmt, attributes = await adapt_connection._prepare(
2025-09-30T01:34:54.9340354Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:768: in _prepare
2025-09-30T01:34:54.9340669Z     prepared_stmt = await self._connection.prepare(
2025-09-30T01:34:54.9341173Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:635: in prepare
2025-09-30T01:34:54.9341313Z     return await self._prepare(
2025-09-30T01:34:54.9341863Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:653: in _prepare
2025-09-30T01:34:54.9342007Z     stmt = await self._get_statement(
2025-09-30T01:34:54.9342475Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:432: in _get_statement
2025-09-30T01:34:54.9342611Z     statement = await self._protocol.prepare(
2025-09-30T01:34:54.9342775Z asyncpg/protocol/protocol.pyx:165: in prepare
2025-09-30T01:34:54.9342869Z     ???
2025-09-30T01:34:54.9344798Z E   RuntimeError: Task <Task pending name='Task-116' coro=<TestIntegrationAPI.test_get_all_rooms_endpoint() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_integration_api.py:93> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9345075Z ---------------------------- Captured stdout setup -----------------------------
2025-09-30T01:34:54.9345389Z ✅ Created integration test user with ID: 1
2025-09-30T01:34:54.9345595Z ✅ Created integration test room with ID: 1
2025-09-30T01:34:54.9345878Z _______________ TestIntegrationAPI.test_get_room_by_id_endpoint ________________
2025-09-30T01:34:54.9346133Z tests/e2e/test_integration_api.py:106: in test_get_room_by_id_endpoint
2025-09-30T01:34:54.9346426Z     response = await authenticated_client.get(f"/api/v1/rooms/{test_room.id}")
2025-09-30T01:34:54.9346560Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9346949Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1768: in get
2025-09-30T01:34:54.9347093Z     return await self.request(
2025-09-30T01:34:54.9347499Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1540: in request
2025-09-30T01:34:54.9347762Z     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-09-30T01:34:54.9347908Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9348278Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1629: in send
2025-09-30T01:34:54.9348435Z     response = await self._send_handling_auth(
2025-09-30T01:34:54.9348904Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
2025-09-30T01:34:54.9349060Z     response = await self._send_handling_redirects(
2025-09-30T01:34:54.9349664Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
2025-09-30T01:34:54.9349862Z     response = await self._send_single_request(request)
2025-09-30T01:34:54.9349980Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9350464Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
2025-09-30T01:34:54.9350690Z     response = await transport.handle_async_request(request)
2025-09-30T01:34:54.9350810Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9351330Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
2025-09-30T01:34:54.9351484Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.9351947Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/applications.py:1054: in __call__
2025-09-30T01:34:54.9352111Z     await super().__call__(scope, receive, send)
2025-09-30T01:34:54.9352580Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/applications.py:112: in __call__
2025-09-30T01:34:54.9352895Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.9353401Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:187: in __call__
2025-09-30T01:34:54.9353590Z     raise exc
2025-09-30T01:34:54.9354059Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:165: in __call__
2025-09-30T01:34:54.9354203Z     await self.app(scope, receive, _send)
2025-09-30T01:34:54.9354700Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/exceptions.py:62: in __call__
2025-09-30T01:34:54.9354971Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-09-30T01:34:54.9355483Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.9355587Z     raise exc
2025-09-30T01:34:54.9356070Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.9356214Z     await app(scope, receive, sender)
2025-09-30T01:34:54.9356640Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:714: in __call__
2025-09-30T01:34:54.9356819Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.9357245Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:734: in app
2025-09-30T01:34:54.9357395Z     await route.handle(scope, receive, send)
2025-09-30T01:34:54.9357806Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:288: in handle
2025-09-30T01:34:54.9357940Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.9358338Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:76: in app
2025-09-30T01:34:54.9358593Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-09-30T01:34:54.9359101Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.9359328Z     raise exc
2025-09-30T01:34:54.9359852Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.9360007Z     await app(scope, receive, sender)
2025-09-30T01:34:54.9360428Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:73: in app
2025-09-30T01:34:54.9360563Z     response = await f(request)
2025-09-30T01:34:54.9360671Z                ^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9361095Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/routing.py:301: in app
2025-09-30T01:34:54.9361260Z     raw_response = await run_endpoint_function(
2025-09-30T01:34:54.9361761Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/routing.py:212: in run_endpoint_function
2025-09-30T01:34:54.9361911Z     return await dependant.call(**values)
2025-09-30T01:34:54.9362034Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9362246Z app/api/v1/endpoints/room_router.py:129: in get_room_by_id
2025-09-30T01:34:54.9362416Z     return await room_service.get_room_by_id(room_id)
2025-09-30T01:34:54.9362542Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9362725Z app/services/room_service.py:138: in get_room_by_id
2025-09-30T01:34:54.9362887Z     return await self._get_room_or_404(room_id)
2025-09-30T01:34:54.9363016Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9363195Z app/services/room_service.py:360: in _get_room_or_404
2025-09-30T01:34:54.9363361Z     room = await self.room_repo.get_by_id(room_id)
2025-09-30T01:34:54.9363488Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9363684Z app/repositories/room_repository.py:58: in get_by_id
2025-09-30T01:34:54.9363828Z     result = await self.db.execute(query)
2025-09-30T01:34:54.9364107Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9364649Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:463: in execute
2025-09-30T01:34:54.9364778Z     result = await greenlet_spawn(
2025-09-30T01:34:54.9365446Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
2025-09-30T01:34:54.9365582Z     result = context.throw(*sys.exc_info())
2025-09-30T01:34:54.9365701Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9366154Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-09-30T01:34:54.9366281Z     return self._execute_internal(
2025-09-30T01:34:54.9366773Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-09-30T01:34:54.9367004Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-09-30T01:34:54.9367568Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-09-30T01:34:54.9367697Z     result = conn.execute(
2025-09-30T01:34:54.9368173Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1415: in execute
2025-09-30T01:34:54.9368281Z     return meth(
2025-09-30T01:34:54.9368829Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:523: in _execute_on_connection
2025-09-30T01:34:54.9368987Z     return connection._execute_clauseelement(
2025-09-30T01:34:54.9369678Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1637: in _execute_clauseelement
2025-09-30T01:34:54.9369824Z     ret = self._execute_context(
2025-09-30T01:34:54.9370366Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1842: in _execute_context
2025-09-30T01:34:54.9370518Z     return self._exec_single_context(
2025-09-30T01:34:54.9371090Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1982: in _exec_single_context
2025-09-30T01:34:54.9371223Z     self._handle_dbapi_exception(
2025-09-30T01:34:54.9371776Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2354: in _handle_dbapi_exception
2025-09-30T01:34:54.9371935Z     raise exc_info[1].with_traceback(exc_info[2])
2025-09-30T01:34:54.9372482Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1963: in _exec_single_context
2025-09-30T01:34:54.9372610Z     self.dialect.do_execute(
2025-09-30T01:34:54.9373117Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:943: in do_execute
2025-09-30T01:34:54.9373270Z     cursor.execute(statement, parameters)
2025-09-30T01:34:54.9373861Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
2025-09-30T01:34:54.9374012Z     self._adapt_connection.await_(
2025-09-30T01:34:54.9374548Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.9374953Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.9375082Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9375627Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.9375737Z     value = await result
2025-09-30T01:34:54.9375842Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.9376474Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
2025-09-30T01:34:54.9376594Z     self._handle_exception(error)
2025-09-30T01:34:54.9377229Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
2025-09-30T01:34:54.9377534Z     self._adapt_connection._handle_exception(error)
2025-09-30T01:34:54.9378138Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:794: in _handle_exception
2025-09-30T01:34:54.9378343Z     raise error
2025-09-30T01:34:54.9378967Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:521: in _prepare_and_execute
2025-09-30T01:34:54.9379336Z     prepared_stmt, attributes = await adapt_connection._prepare(
2025-09-30T01:34:54.9379913Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:768: in _prepare
2025-09-30T01:34:54.9380097Z     prepared_stmt = await self._connection.prepare(
2025-09-30T01:34:54.9380531Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:635: in prepare
2025-09-30T01:34:54.9380671Z     return await self._prepare(
2025-09-30T01:34:54.9381120Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:653: in _prepare
2025-09-30T01:34:54.9381247Z     stmt = await self._get_statement(
2025-09-30T01:34:54.9381697Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:432: in _get_statement
2025-09-30T01:34:54.9381852Z     statement = await self._protocol.prepare(
2025-09-30T01:34:54.9382006Z asyncpg/protocol/protocol.pyx:165: in prepare
2025-09-30T01:34:54.9382108Z     ???
2025-09-30T01:34:54.9384135Z E   RuntimeError: Task <Task pending name='Task-126' coro=<TestIntegrationAPI.test_get_room_by_id_endpoint() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_integration_api.py:106> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9384429Z ---------------------------- Captured stdout setup -----------------------------
2025-09-30T01:34:54.9384737Z ✅ Created integration test user with ID: 1
2025-09-30T01:34:54.9384969Z ✅ Created integration test room with ID: 1
2025-09-30T01:34:54.9385286Z __________________ TestIntegrationAPI.test_join_room_workflow __________________
2025-09-30T01:34:54.9385556Z tests/e2e/test_integration_api.py:118: in test_join_room_workflow
2025-09-30T01:34:54.9385875Z     response = await authenticated_client.post(f"/api/v1/rooms/{test_room.id}/join")
2025-09-30T01:34:54.9386028Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9386451Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1859: in post
2025-09-30T01:34:54.9386580Z     return await self.request(
2025-09-30T01:34:54.9386981Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1540: in request
2025-09-30T01:34:54.9387282Z     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-09-30T01:34:54.9387422Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9387862Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1629: in send
2025-09-30T01:34:54.9388021Z     response = await self._send_handling_auth(
2025-09-30T01:34:54.9388495Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
2025-09-30T01:34:54.9388667Z     response = await self._send_handling_redirects(
2025-09-30T01:34:54.9389335Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
2025-09-30T01:34:54.9389532Z     response = await self._send_single_request(request)
2025-09-30T01:34:54.9389675Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9390196Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
2025-09-30T01:34:54.9390552Z     response = await transport.handle_async_request(request)
2025-09-30T01:34:54.9390696Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9391704Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
2025-09-30T01:34:54.9391858Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.9392288Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/applications.py:1054: in __call__
2025-09-30T01:34:54.9392447Z     await super().__call__(scope, receive, send)
2025-09-30T01:34:54.9392897Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/applications.py:112: in __call__
2025-09-30T01:34:54.9393052Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.9393484Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:187: in __call__
2025-09-30T01:34:54.9393600Z     raise exc
2025-09-30T01:34:54.9394045Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:165: in __call__
2025-09-30T01:34:54.9394173Z     await self.app(scope, receive, _send)
2025-09-30T01:34:54.9394649Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/exceptions.py:62: in __call__
2025-09-30T01:34:54.9394898Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-09-30T01:34:54.9395371Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.9395472Z     raise exc
2025-09-30T01:34:54.9395961Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.9396097Z     await app(scope, receive, sender)
2025-09-30T01:34:54.9396572Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:714: in __call__
2025-09-30T01:34:54.9396764Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.9397188Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:734: in app
2025-09-30T01:34:54.9397363Z     await route.handle(scope, receive, send)
2025-09-30T01:34:54.9397752Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:288: in handle
2025-09-30T01:34:54.9397897Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.9398323Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:76: in app
2025-09-30T01:34:54.9398582Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-09-30T01:34:54.9399104Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.9399354Z     raise exc
2025-09-30T01:34:54.9399881Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.9400021Z     await app(scope, receive, sender)
2025-09-30T01:34:54.9400423Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:73: in app
2025-09-30T01:34:54.9400562Z     response = await f(request)
2025-09-30T01:34:54.9400675Z                ^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9401107Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/routing.py:301: in app
2025-09-30T01:34:54.9401271Z     raw_response = await run_endpoint_function(
2025-09-30T01:34:54.9402422Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/routing.py:212: in run_endpoint_function
2025-09-30T01:34:54.9402576Z     return await dependant.call(**values)
2025-09-30T01:34:54.9402689Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9402887Z app/api/v1/endpoints/room_router.py:149: in join_room
2025-09-30T01:34:54.9403276Z     join_response = await room_service.join_room(current_user, room_id)
2025-09-30T01:34:54.9403398Z                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9403576Z app/services/room_service.py:157: in join_room
2025-09-30T01:34:54.9403846Z     room = await self._get_room_or_404(room_id)
2025-09-30T01:34:54.9403951Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9404153Z app/services/room_service.py:360: in _get_room_or_404
2025-09-30T01:34:54.9404319Z     room = await self.room_repo.get_by_id(room_id)
2025-09-30T01:34:54.9404434Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9404634Z app/repositories/room_repository.py:58: in get_by_id
2025-09-30T01:34:54.9404759Z     result = await self.db.execute(query)
2025-09-30T01:34:54.9404858Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9405387Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:463: in execute
2025-09-30T01:34:54.9405525Z     result = await greenlet_spawn(
2025-09-30T01:34:54.9406068Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
2025-09-30T01:34:54.9406214Z     result = context.throw(*sys.exc_info())
2025-09-30T01:34:54.9406317Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9406752Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-09-30T01:34:54.9406889Z     return self._execute_internal(
2025-09-30T01:34:54.9407460Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-09-30T01:34:54.9407692Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-09-30T01:34:54.9408251Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-09-30T01:34:54.9408387Z     result = conn.execute(
2025-09-30T01:34:54.9408863Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1415: in execute
2025-09-30T01:34:54.9408978Z     return meth(
2025-09-30T01:34:54.9409704Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:523: in _execute_on_connection
2025-09-30T01:34:54.9409870Z     return connection._execute_clauseelement(
2025-09-30T01:34:54.9410414Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1637: in _execute_clauseelement
2025-09-30T01:34:54.9410540Z     ret = self._execute_context(
2025-09-30T01:34:54.9411081Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1842: in _execute_context
2025-09-30T01:34:54.9411223Z     return self._exec_single_context(
2025-09-30T01:34:54.9411812Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1982: in _exec_single_context
2025-09-30T01:34:54.9411931Z     self._handle_dbapi_exception(
2025-09-30T01:34:54.9412449Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2354: in _handle_dbapi_exception
2025-09-30T01:34:54.9412594Z     raise exc_info[1].with_traceback(exc_info[2])
2025-09-30T01:34:54.9413110Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1963: in _exec_single_context
2025-09-30T01:34:54.9413248Z     self.dialect.do_execute(
2025-09-30T01:34:54.9413691Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:943: in do_execute
2025-09-30T01:34:54.9413816Z     cursor.execute(statement, parameters)
2025-09-30T01:34:54.9414301Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
2025-09-30T01:34:54.9414424Z     self._adapt_connection.await_(
2025-09-30T01:34:54.9414959Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.9415492Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.9415596Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9416206Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.9416307Z     value = await result
2025-09-30T01:34:54.9416407Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.9417040Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
2025-09-30T01:34:54.9417160Z     self._handle_exception(error)
2025-09-30T01:34:54.9417802Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
2025-09-30T01:34:54.9417982Z     self._adapt_connection._handle_exception(error)
2025-09-30T01:34:54.9418624Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:794: in _handle_exception
2025-09-30T01:34:54.9418735Z     raise error
2025-09-30T01:34:54.9419504Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:521: in _prepare_and_execute
2025-09-30T01:34:54.9419744Z     prepared_stmt, attributes = await adapt_connection._prepare(
2025-09-30T01:34:54.9420320Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:768: in _prepare
2025-09-30T01:34:54.9420505Z     prepared_stmt = await self._connection.prepare(
2025-09-30T01:34:54.9420932Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:635: in prepare
2025-09-30T01:34:54.9421057Z     return await self._prepare(
2025-09-30T01:34:54.9421451Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:653: in _prepare
2025-09-30T01:34:54.9421575Z     stmt = await self._get_statement(
2025-09-30T01:34:54.9422024Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:432: in _get_statement
2025-09-30T01:34:54.9422185Z     statement = await self._protocol.prepare(
2025-09-30T01:34:54.9422347Z asyncpg/protocol/protocol.pyx:165: in prepare
2025-09-30T01:34:54.9422449Z     ???
2025-09-30T01:34:54.9425092Z E   RuntimeError: Task <Task pending name='Task-136' coro=<TestIntegrationAPI.test_join_room_workflow() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_integration_api.py:118> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9425454Z ---------------------------- Captured stdout setup -----------------------------
2025-09-30T01:34:54.9425941Z ✅ Created integration test user with ID: 1
2025-09-30T01:34:54.9426291Z ✅ Created integration test room with ID: 1
2025-09-30T01:34:54.9426747Z ____________ TestIntegrationAPI.test_send_and_get_messages_workflow ____________
2025-09-30T01:34:54.9427569Z tests/e2e/test_integration_api.py:143: in test_send_and_get_messages_workflow
2025-09-30T01:34:54.9428123Z     join_response = await authenticated_client.post(f"/api/v1/rooms/{test_room.id}/join")
2025-09-30T01:34:54.9428348Z                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9429079Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1859: in post
2025-09-30T01:34:54.9429395Z     return await self.request(
2025-09-30T01:34:54.9430119Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1540: in request
2025-09-30T01:34:54.9430622Z     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-09-30T01:34:54.9430970Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9431641Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1629: in send
2025-09-30T01:34:54.9431893Z     response = await self._send_handling_auth(
2025-09-30T01:34:54.9432773Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
2025-09-30T01:34:54.9433047Z     response = await self._send_handling_redirects(
2025-09-30T01:34:54.9433889Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
2025-09-30T01:34:54.9434172Z     response = await self._send_single_request(request)
2025-09-30T01:34:54.9434347Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9435381Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
2025-09-30T01:34:54.9435716Z     response = await transport.handle_async_request(request)
2025-09-30T01:34:54.9436038Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9436939Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
2025-09-30T01:34:54.9437124Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.9438434Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/applications.py:1054: in __call__
2025-09-30T01:34:54.9438647Z     await super().__call__(scope, receive, send)
2025-09-30T01:34:54.9439498Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/applications.py:112: in __call__
2025-09-30T01:34:54.9439770Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.9440545Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:187: in __call__
2025-09-30T01:34:54.9440698Z     raise exc
2025-09-30T01:34:54.9441500Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:165: in __call__
2025-09-30T01:34:54.9441742Z     await self.app(scope, receive, _send)
2025-09-30T01:34:54.9442578Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/exceptions.py:62: in __call__
2025-09-30T01:34:54.9443015Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-09-30T01:34:54.9443839Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.9444033Z     raise exc
2025-09-30T01:34:54.9444725Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.9444894Z     await app(scope, receive, sender)
2025-09-30T01:34:54.9445631Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:714: in __call__
2025-09-30T01:34:54.9445876Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.9446503Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:734: in app
2025-09-30T01:34:54.9446724Z     await route.handle(scope, receive, send)
2025-09-30T01:34:54.9447363Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:288: in handle
2025-09-30T01:34:54.9447570Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.9448211Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:76: in app
2025-09-30T01:34:54.9448650Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-09-30T01:34:54.9449600Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.9449803Z     raise exc
2025-09-30T01:34:54.9450695Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.9451106Z     await app(scope, receive, sender)
2025-09-30T01:34:54.9451814Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:73: in app
2025-09-30T01:34:54.9451981Z     response = await f(request)
2025-09-30T01:34:54.9452225Z                ^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9452921Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/routing.py:301: in app
2025-09-30T01:34:54.9453164Z     raw_response = await run_endpoint_function(
2025-09-30T01:34:54.9453984Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/routing.py:212: in run_endpoint_function
2025-09-30T01:34:54.9454209Z     return await dependant.call(**values)
2025-09-30T01:34:54.9454403Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9454685Z app/api/v1/endpoints/room_router.py:149: in join_room
2025-09-30T01:34:54.9455078Z     join_response = await room_service.join_room(current_user, room_id)
2025-09-30T01:34:54.9455269Z                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9455513Z app/services/room_service.py:157: in join_room
2025-09-30T01:34:54.9455780Z     room = await self._get_room_or_404(room_id)
2025-09-30T01:34:54.9455999Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9456375Z app/services/room_service.py:360: in _get_room_or_404
2025-09-30T01:34:54.9456667Z     room = await self.room_repo.get_by_id(room_id)
2025-09-30T01:34:54.9456839Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9457127Z app/repositories/room_repository.py:58: in get_by_id
2025-09-30T01:34:54.9457334Z     result = await self.db.execute(query)
2025-09-30T01:34:54.9457510Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9458553Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:463: in execute
2025-09-30T01:34:54.9458756Z     result = await greenlet_spawn(
2025-09-30T01:34:54.9459597Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
2025-09-30T01:34:54.9459786Z     result = context.throw(*sys.exc_info())
2025-09-30T01:34:54.9459946Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9460518Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-09-30T01:34:54.9460673Z     return self._execute_internal(
2025-09-30T01:34:54.9461375Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-09-30T01:34:54.9461671Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-09-30T01:34:54.9462323Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-09-30T01:34:54.9462522Z     result = conn.execute(
2025-09-30T01:34:54.9463116Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1415: in execute
2025-09-30T01:34:54.9463244Z     return meth(
2025-09-30T01:34:54.9463985Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:523: in _execute_on_connection
2025-09-30T01:34:54.9464184Z     return connection._execute_clauseelement(
2025-09-30T01:34:54.9464900Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1637: in _execute_clauseelement
2025-09-30T01:34:54.9465079Z     ret = self._execute_context(
2025-09-30T01:34:54.9465780Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1842: in _execute_context
2025-09-30T01:34:54.9465959Z     return self._exec_single_context(
2025-09-30T01:34:54.9466673Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1982: in _exec_single_context
2025-09-30T01:34:54.9466833Z     self._handle_dbapi_exception(
2025-09-30T01:34:54.9467563Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2354: in _handle_dbapi_exception
2025-09-30T01:34:54.9467916Z     raise exc_info[1].with_traceback(exc_info[2])
2025-09-30T01:34:54.9468556Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1963: in _exec_single_context
2025-09-30T01:34:54.9468846Z     self.dialect.do_execute(
2025-09-30T01:34:54.9469622Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:943: in do_execute
2025-09-30T01:34:54.9469781Z     cursor.execute(statement, parameters)
2025-09-30T01:34:54.9470522Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
2025-09-30T01:34:54.9470696Z     self._adapt_connection.await_(
2025-09-30T01:34:54.9471410Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.9471909Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.9472031Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9472773Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.9472924Z     value = await result
2025-09-30T01:34:54.9473058Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.9473855Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
2025-09-30T01:34:54.9474007Z     self._handle_exception(error)
2025-09-30T01:34:54.9474843Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
2025-09-30T01:34:54.9475061Z     self._adapt_connection._handle_exception(error)
2025-09-30T01:34:54.9475898Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:794: in _handle_exception
2025-09-30T01:34:54.9476049Z     raise error
2025-09-30T01:34:54.9476896Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:521: in _prepare_and_execute
2025-09-30T01:34:54.9477189Z     prepared_stmt, attributes = await adapt_connection._prepare(
2025-09-30T01:34:54.9477992Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:768: in _prepare
2025-09-30T01:34:54.9478231Z     prepared_stmt = await self._connection.prepare(
2025-09-30T01:34:54.9478767Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:635: in prepare
2025-09-30T01:34:54.9478917Z     return await self._prepare(
2025-09-30T01:34:54.9479639Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:653: in _prepare
2025-09-30T01:34:54.9479811Z     stmt = await self._get_statement(
2025-09-30T01:34:54.9480410Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:432: in _get_statement
2025-09-30T01:34:54.9480616Z     statement = await self._protocol.prepare(
2025-09-30T01:34:54.9480820Z asyncpg/protocol/protocol.pyx:165: in prepare
2025-09-30T01:34:54.9480944Z     ???
2025-09-30T01:34:54.9483648Z E   RuntimeError: Task <Task pending name='Task-146' coro=<TestIntegrationAPI.test_send_and_get_messages_workflow() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_integration_api.py:143> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9483924Z ---------------------------- Captured stdout setup -----------------------------
2025-09-30T01:34:54.9484279Z ✅ Created integration test user with ID: 1
2025-09-30T01:34:54.9484557Z ✅ Created integration test room with ID: 1
2025-09-30T01:34:54.9485046Z _________________ TestIntegrationAPI.test_leave_room_workflow __________________
2025-09-30T01:34:54.9485391Z tests/e2e/test_integration_api.py:172: in test_leave_room_workflow
2025-09-30T01:34:54.9485857Z     join_response = await authenticated_client.post(f"/api/v1/rooms/{test_room.id}/join")
2025-09-30T01:34:54.9486135Z                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9486647Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1859: in post
2025-09-30T01:34:54.9486834Z     return await self.request(
2025-09-30T01:34:54.9487354Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1540: in request
2025-09-30T01:34:54.9487796Z     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-09-30T01:34:54.9487982Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9488543Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1629: in send
2025-09-30T01:34:54.9488722Z     response = await self._send_handling_auth(
2025-09-30T01:34:54.9489499Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1657: in _send_handling_auth
2025-09-30T01:34:54.9489722Z     response = await self._send_handling_redirects(
2025-09-30T01:34:54.9490473Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1694: in _send_handling_redirects
2025-09-30T01:34:54.9490751Z     response = await self._send_single_request(request)
2025-09-30T01:34:54.9490912Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9491517Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_client.py:1730: in _send_single_request
2025-09-30T01:34:54.9491851Z     response = await transport.handle_async_request(request)
2025-09-30T01:34:54.9492031Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9492738Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/httpx/_transports/asgi.py:170: in handle_async_request
2025-09-30T01:34:54.9492942Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.9493647Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/applications.py:1054: in __call__
2025-09-30T01:34:54.9493863Z     await super().__call__(scope, receive, send)
2025-09-30T01:34:54.9494615Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/applications.py:112: in __call__
2025-09-30T01:34:54.9494869Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.9495866Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:187: in __call__
2025-09-30T01:34:54.9496026Z     raise exc
2025-09-30T01:34:54.9496846Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/errors.py:165: in __call__
2025-09-30T01:34:54.9497124Z     await self.app(scope, receive, _send)
2025-09-30T01:34:54.9498102Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/middleware/exceptions.py:62: in __call__
2025-09-30T01:34:54.9498696Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-09-30T01:34:54.9499987Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.9500210Z     raise exc
2025-09-30T01:34:54.9501364Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.9501653Z     await app(scope, receive, sender)
2025-09-30T01:34:54.9502636Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:714: in __call__
2025-09-30T01:34:54.9503002Z     await self.middleware_stack(scope, receive, send)
2025-09-30T01:34:54.9503934Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:734: in app
2025-09-30T01:34:54.9504402Z     await route.handle(scope, receive, send)
2025-09-30T01:34:54.9505356Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:288: in handle
2025-09-30T01:34:54.9505756Z     await self.app(scope, receive, send)
2025-09-30T01:34:54.9506667Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:76: in app
2025-09-30T01:34:54.9507247Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-09-30T01:34:54.9508395Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-09-30T01:34:54.9508609Z     raise exc
2025-09-30T01:34:54.9509879Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-09-30T01:34:54.9510156Z     await app(scope, receive, sender)
2025-09-30T01:34:54.9511072Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/starlette/routing.py:73: in app
2025-09-30T01:34:54.9511346Z     response = await f(request)
2025-09-30T01:34:54.9511570Z                ^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9512465Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/routing.py:301: in app
2025-09-30T01:34:54.9512797Z     raw_response = await run_endpoint_function(
2025-09-30T01:34:54.9513920Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/fastapi/routing.py:212: in run_endpoint_function
2025-09-30T01:34:54.9514203Z     return await dependant.call(**values)
2025-09-30T01:34:54.9514440Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9514825Z app/api/v1/endpoints/room_router.py:149: in join_room
2025-09-30T01:34:54.9515336Z     join_response = await room_service.join_room(current_user, room_id)
2025-09-30T01:34:54.9515595Z                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9515929Z app/services/room_service.py:157: in join_room
2025-09-30T01:34:54.9516226Z     room = await self._get_room_or_404(room_id)
2025-09-30T01:34:54.9516461Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9516850Z app/services/room_service.py:360: in _get_room_or_404
2025-09-30T01:34:54.9517182Z     room = await self.room_repo.get_by_id(room_id)
2025-09-30T01:34:54.9517422Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9517817Z app/repositories/room_repository.py:58: in get_by_id
2025-09-30T01:34:54.9518097Z     result = await self.db.execute(query)
2025-09-30T01:34:54.9518329Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9519581Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:463: in execute
2025-09-30T01:34:54.9519851Z     result = await greenlet_spawn(
2025-09-30T01:34:54.9521087Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
2025-09-30T01:34:54.9521379Z     result = context.throw(*sys.exc_info())
2025-09-30T01:34:54.9521617Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9522666Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-09-30T01:34:54.9522946Z     return self._execute_internal(
2025-09-30T01:34:54.9524121Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-09-30T01:34:54.9524594Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-09-30T01:34:54.9525811Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-09-30T01:34:54.9526058Z     result = conn.execute(
2025-09-30T01:34:54.9527096Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1415: in execute
2025-09-30T01:34:54.9527318Z     return meth(
2025-09-30T01:34:54.9528553Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:523: in _execute_on_connection
2025-09-30T01:34:54.9528941Z     return connection._execute_clauseelement(
2025-09-30T01:34:54.9529925Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1637: in _execute_clauseelement
2025-09-30T01:34:54.9530233Z     ret = self._execute_context(
2025-09-30T01:34:54.9531116Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1842: in _execute_context
2025-09-30T01:34:54.9531327Z     return self._exec_single_context(
2025-09-30T01:34:54.9532284Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1982: in _exec_single_context
2025-09-30T01:34:54.9532500Z     self._handle_dbapi_exception(
2025-09-30T01:34:54.9533484Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2354: in _handle_dbapi_exception
2025-09-30T01:34:54.9533743Z     raise exc_info[1].with_traceback(exc_info[2])
2025-09-30T01:34:54.9534689Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1963: in _exec_single_context
2025-09-30T01:34:54.9534884Z     self.dialect.do_execute(
2025-09-30T01:34:54.9535763Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:943: in do_execute
2025-09-30T01:34:54.9536001Z     cursor.execute(statement, parameters)
2025-09-30T01:34:54.9536988Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:580: in execute
2025-09-30T01:34:54.9537203Z     self._adapt_connection.await_(
2025-09-30T01:34:54.9538149Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
2025-09-30T01:34:54.9538819Z     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
2025-09-30T01:34:54.9539010Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-30T01:34:54.9540146Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
2025-09-30T01:34:54.9540345Z     value = await result
2025-09-30T01:34:54.9540536Z             ^^^^^^^^^^^^
2025-09-30T01:34:54.9541684Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:558: in _prepare_and_execute
2025-09-30T01:34:54.9541898Z     self._handle_exception(error)
2025-09-30T01:34:54.9543018Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:508: in _handle_exception
2025-09-30T01:34:54.9543296Z     self._adapt_connection._handle_exception(error)
2025-09-30T01:34:54.9544430Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:794: in _handle_exception
2025-09-30T01:34:54.9544617Z     raise error
2025-09-30T01:34:54.9545772Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:521: in _prepare_and_execute
2025-09-30T01:34:54.9546138Z     prepared_stmt, attributes = await adapt_connection._prepare(
2025-09-30T01:34:54.9547158Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:768: in _prepare
2025-09-30T01:34:54.9547457Z     prepared_stmt = await self._connection.prepare(
2025-09-30T01:34:54.9548302Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:635: in prepare
2025-09-30T01:34:54.9548524Z     return await self._prepare(
2025-09-30T01:34:54.9549453Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:653: in _prepare
2025-09-30T01:34:54.9549686Z     stmt = await self._get_statement(
2025-09-30T01:34:54.9550545Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/asyncpg/connection.py:432: in _get_statement
2025-09-30T01:34:54.9550779Z     statement = await self._protocol.prepare(
2025-09-30T01:34:54.9551211Z asyncpg/protocol/protocol.pyx:165: in prepare
2025-09-30T01:34:54.9551377Z     ???
2025-09-30T01:34:54.9554256Z E   RuntimeError: Task <Task pending name='Task-156' coro=<TestIntegrationAPI.test_leave_room_workflow() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_integration_api.py:172> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9554752Z ---------------------------- Captured stdout setup -----------------------------
2025-09-30T01:34:54.9555021Z ✅ Created integration test user with ID: 1
2025-09-30T01:34:54.9555227Z ✅ Created integration test room with ID: 1
2025-09-30T01:34:54.9555422Z =========================== short test summary info ============================
2025-09-30T01:34:54.9557975Z FAILED tests/e2e/test_critical_workflows.py::TestCriticalUserJourneys::test_complete_chat_workflow - RuntimeError: Task <Task pending name='Task-8' coro=<TestCriticalUserJourneys.test_complete_chat_workflow() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_critical_workflows.py:24> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9560726Z FAILED tests/e2e/test_critical_workflows.py::TestCriticalUserJourneys::test_room_closure_workflow - RuntimeError: Task <Task pending name='Task-20' coro=<TestCriticalUserJourneys.test_room_closure_workflow() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_critical_workflows.py:95> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9563243Z FAILED tests/e2e/test_critical_workflows.py::TestCriticalUserJourneys::test_authentication_security - RuntimeError: Task <Task pending name='Task-28' coro=<TestCriticalUserJourneys.test_authentication_security() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_critical_workflows.py:146> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9564690Z FAILED tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_message_xor_constraint - sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
2025-09-30T01:34:54.9564940Z (Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-09-30T01:34:54.9567360Z FAILED tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_foreign_key_constraints - RuntimeError: Task <Task pending name='Task-53' coro=<TestDatabaseConstraints.test_foreign_key_constraints() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_database_constraints.py:112> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9568859Z FAILED tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_conversation_participant_constraints - sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
2025-09-30T01:34:54.9569102Z (Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-09-30T01:34:54.9570806Z FAILED tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_nullable_constraints - sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
2025-09-30T01:34:54.9571130Z (Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-09-30T01:34:54.9573448Z FAILED tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_database_indexes_exist - RuntimeError: Task <Task pending name='Task-87' coro=<TestDatabaseConstraints.test_database_indexes_exist() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_database_constraints.py:280> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9575817Z FAILED tests/e2e/test_integration_api.py::TestIntegrationAPI::test_room_count_endpoint - RuntimeError: Task <Task pending name='Task-106' coro=<TestIntegrationAPI.test_room_count_endpoint() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_integration_api.py:83> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9578187Z FAILED tests/e2e/test_integration_api.py::TestIntegrationAPI::test_get_all_rooms_endpoint - RuntimeError: Task <Task pending name='Task-116' coro=<TestIntegrationAPI.test_get_all_rooms_endpoint() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_integration_api.py:93> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9580667Z FAILED tests/e2e/test_integration_api.py::TestIntegrationAPI::test_get_room_by_id_endpoint - RuntimeError: Task <Task pending name='Task-126' coro=<TestIntegrationAPI.test_get_room_by_id_endpoint() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_integration_api.py:106> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9582880Z FAILED tests/e2e/test_integration_api.py::TestIntegrationAPI::test_join_room_workflow - RuntimeError: Task <Task pending name='Task-136' coro=<TestIntegrationAPI.test_join_room_workflow() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_integration_api.py:118> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9585289Z FAILED tests/e2e/test_integration_api.py::TestIntegrationAPI::test_send_and_get_messages_workflow - RuntimeError: Task <Task pending name='Task-146' coro=<TestIntegrationAPI.test_send_and_get_messages_workflow() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_integration_api.py:143> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9587645Z FAILED tests/e2e/test_integration_api.py::TestIntegrationAPI::test_leave_room_workflow - RuntimeError: Task <Task pending name='Task-156' coro=<TestIntegrationAPI.test_leave_room_workflow() running at /home/runner/work/the_gathering_beta/the_gathering_beta/tests/e2e/test_integration_api.py:172> cb=[_run_until_complete_cb() at /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/asyncio/base_events.py:181, WorkerThread.stop()]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-09-30T01:34:54.9589526Z ERROR tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_message_xor_constraint - sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot use Connection.transaction() in a manually started transaction
2025-09-30T01:34:54.9589776Z (Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-09-30T01:34:54.9591245Z ERROR tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_unique_constraints - sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_username"
2025-09-30T01:34:54.9591427Z DETAIL:  Key (username)=(testuser) already exists.
2025-09-30T01:34:54.9592660Z [SQL: INSERT INTO users (email, username, password_hash, avatar_url, preferred_language, status, is_active, last_active, is_admin, current_room_id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::userstatus, $7::BOOLEAN, $8::TIMESTAMP WITH TIME ZONE, $9::BOOLEAN, $10::INTEGER) RETURNING users.id, users.created_at]
2025-09-30T01:34:54.9593466Z [parameters: ('user@example.com', 'testuser', '$2b$12$NxIQ.GNX527tipxO9yDXTOHP./wSI2SkYaMJKcFvpA7yTaAiR2a.q', None, 'en', 'AVAILABLE', True, datetime.datetime(2025, 9, 30, 1, 34, 46, 451953), False, None)]
2025-09-30T01:34:54.9593693Z (Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-09-30T01:34:54.9595278Z ERROR tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_conversation_participant_constraints - sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot use Connection.transaction() in a manually started transaction
2025-09-30T01:34:54.9595545Z (Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-09-30T01:34:54.9596958Z ERROR tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_enum_validation - sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_username"
2025-09-30T01:34:54.9597143Z DETAIL:  Key (username)=(testuser) already exists.
2025-09-30T01:34:54.9598475Z [SQL: INSERT INTO users (email, username, password_hash, avatar_url, preferred_language, status, is_active, last_active, is_admin, current_room_id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::userstatus, $7::BOOLEAN, $8::TIMESTAMP WITH TIME ZONE, $9::BOOLEAN, $10::INTEGER) RETURNING users.id, users.created_at]
2025-09-30T01:34:54.9599493Z [parameters: ('user@example.com', 'testuser', '$2b$12$nT55XU0jHBuETVUIMEl9KuZe.usHUDo9WPAO.nM8u9ra1bNWNkujm', None, 'en', 'AVAILABLE', True, datetime.datetime(2025, 9, 30, 1, 34, 48, 688810), False, None)]
2025-09-30T01:34:55.0163303Z (Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-09-30T01:34:55.0166889Z ERROR tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_nullable_constraints - sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot use Connection.transaction() in a manually started transaction
2025-09-30T01:34:55.0170564Z (Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-09-30T01:34:55.0173932Z ERROR tests/e2e/test_database_constraints.py::TestDatabaseConstraints::test_cascading_deletes - sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_users_username"
2025-09-30T01:34:55.0177710Z DETAIL:  Key (username)=(testuser) already exists.
2025-09-30T01:34:55.0191521Z [SQL: INSERT INTO users (email, username, password_hash, avatar_url, preferred_language, status, is_active, last_active, is_admin, current_room_id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::userstatus, $7::BOOLEAN, $8::TIMESTAMP WITH TIME ZONE, $9::BOOLEAN, $10::INTEGER) RETURNING users.id, users.created_at]
2025-09-30T01:34:55.0194088Z [parameters: ('user@example.com', 'testuser', '$2b$12$BGFzZsF4tNm7.hmvv1w96.i.Rxf5vzFIXX5VL73oGmZBZvpwkaFWe', None, 'en', 'AVAILABLE', True, datetime.datetime(2025, 9, 30, 1, 34, 50, 617443), False, None)]
2025-09-30T01:34:55.0195278Z (Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-09-30T01:34:55.0195860Z ============== 14 failed, 1 passed, 1 warning, 6 errors in 13.50s ==============
2025-09-30T01:34:55.2110967Z ##[error]Process completed with exit code 1.
